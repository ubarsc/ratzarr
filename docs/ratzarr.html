<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 16.0.0"/>
    <title>ratzarr API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:27px;vertical-align:bottom;width:50px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>




            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="variable" href="#CHUNKSIZE_ATTR">CHUNKSIZE_ATTR</a>
            </li>
            <li>
                    <a class="variable" href="#DFLT_CHUNKSIZE">DFLT_CHUNKSIZE</a>
            </li>
            <li>
                    <a class="class" href="#RatZarr">RatZarr</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#RatZarr.__init__">RatZarr</a>
                        </li>
                        <li>
                                <a class="variable" href="#RatZarr.usingS3">usingS3</a>
                        </li>
                        <li>
                                <a class="variable" href="#RatZarr.filename">filename</a>
                        </li>
                        <li>
                                <a class="variable" href="#RatZarr.grpName">grpName</a>
                        </li>
                        <li>
                                <a class="variable" href="#RatZarr.grp">grp</a>
                        </li>
                        <li>
                                <a class="variable" href="#RatZarr.columnCache">columnCache</a>
                        </li>
                        <li>
                                <a class="variable" href="#RatZarr.chunksize">chunksize</a>
                        </li>
                        <li>
                                <a class="variable" href="#RatZarr.blockChunkMultipleWarningDone">blockChunkMultipleWarningDone</a>
                        </li>
                        <li>
                                <a class="variable" href="#RatZarr.smallBlockWarningDone">smallBlockWarningDone</a>
                        </li>
                        <li>
                                <a class="function" href="#RatZarr.setRowCount">setRowCount</a>
                        </li>
                        <li>
                                <a class="function" href="#RatZarr.getRowCount">getRowCount</a>
                        </li>
                        <li>
                                <a class="function" href="#RatZarr.colExists">colExists</a>
                        </li>
                        <li>
                                <a class="function" href="#RatZarr.getColumnNames">getColumnNames</a>
                        </li>
                        <li>
                                <a class="function" href="#RatZarr.createColumn">createColumn</a>
                        </li>
                        <li>
                                <a class="function" href="#RatZarr.deleteColumn">deleteColumn</a>
                        </li>
                        <li>
                                <a class="function" href="#RatZarr.openColumn">openColumn</a>
                        </li>
                        <li>
                                <a class="function" href="#RatZarr.readBlock">readBlock</a>
                        </li>
                        <li>
                                <a class="function" href="#RatZarr.writeBlock">writeBlock</a>
                        </li>
                        <li>
                                <a class="function" href="#RatZarr.setChunkSize">setChunkSize</a>
                        </li>
                        <li>
                                <a class="function" href="#RatZarr.getRATChunkSize">getRATChunkSize</a>
                        </li>
                        <li>
                                <a class="function" href="#RatZarr.getColumnChunkSize">getColumnChunkSize</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#RatZarrError">RatZarrError</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="variable" href="#colNameByType">colNameByType</a>
            </li>
            <li>
                    <a class="class" href="#AllTests">AllTests</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#AllTests.test_simple">test_simple</a>
                        </li>
                        <li>
                                <a class="function" href="#AllTests.test_flags">test_flags</a>
                        </li>
                        <li>
                                <a class="function" href="#AllTests.test_resize">test_resize</a>
                        </li>
                        <li>
                                <a class="function" href="#AllTests.test_colnames">test_colnames</a>
                        </li>
                        <li>
                                <a class="function" href="#AllTests.test_chunksize">test_chunksize</a>
                        </li>
                        <li>
                                <a class="function" href="#AllTests.makeFilename">makeFilename</a>
                        </li>
                        <li>
                                <a class="function" href="#AllTests.deleteTestFile">deleteTestFile</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#mainCmd">mainCmd</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22160%22%20viewBox%3D%220%200%20150%2080%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M132.316%2048.886c.276-4.679%202.342-6.698%204.409-7.982s4.27-1.165%206.751-1.055c1.586.07%203.044.156%204.222-.482%201.142-.619%202.026-1.932%202.162-3.739.268-3.576-1.929-5.368-5.006-5.551s-7.599.524-10.517%201.606c-4.455%201.652-8.588%206.606-9.552%208.992s-2.342%206.193-1.745%2010.873%202.664%209.221%205.878%2011.79%205.878%203.808%2010.103%204.312%203.444.229%206.062.229%205.006-2.202%204.914-4.909-2.296-5.001-4.501-4.863-3.077.505-5.281.229-7.715-2.064-7.899-9.451z%22%20fill%3D%22%23198754%22/%3E%3Ccircle%20cx%3D%22101.504%22%20cy%3D%2248.943%22%20r%3D%2214.208%22%20fill%3D%22none%22%20stroke%3D%22%23198754%22%20stroke-width%3D%229.354%22/%3E%3Cpath%20d%3D%22M87.81.002c-3.637.065-5.001.454-7.014%201.232s-3.443%201.363-6.3%204.282c-1.723%201.76-3.148%205.019-3.776%207.329-.413%201.521-.316%202.63-.316%202.63l-.195%2034.612c.065%205.774-6.755%208.305-9.612%208.37s-9.678-1.038-9.743-9.408%207.128-9.521%208.362-9.521c1.413-.13%202.526-.021%203.718-.016%202.071.009%204.157-.778%204.092-4.671s-4.157-4.736-4.157-4.736c-6.3-.843-11.43%202.206-11.43%202.206S40.917%2038.15%2041.372%2049.634%2051.568%2068.19%2061.311%2068.125s18.316-7.007%2018.445-17.193l.13-22.772c.046-2.291%202.683-3.644%204.476-4.203.745-.232%201.694-.274%201.694-.274l10.457-.13s4.871-.324%207.729-3.114%204.352-6.294%204.352-6.294.974-3.049.13-4.606-.195-1.233-2.792-3.309-8.573-4.477-8.573-4.477S91.447-.063%2087.81.002zM0%2047.169l.065%2028.417S0%2080.127%204.481%2079.997s5.072-3.866%205.049-4.152l-.113-28.482s1.624-7.656%209.937-7.721%2010.002%206.942%2010.002%208.499-.909%2010.51-9.093%2010.51c-.948%200-2.99-.567-4.145-.272-3.919%201-3.194%204.554-3.194%204.554s.065%205.061%207.404%204.996%2018.575-6.034%2018.575-19.074S26.953%2030.04%2019.549%2029.91%201.234%2035.296%200%2047.169z%22%20fill%3D%22%23198754%22/%3E%3Cg%20transform%3D%22matrix%28.325601%200%200%20.325256%20-10.32669%20-45.802786%29%22%3E%3Ccircle%20cx%3D%22297.554%22%20cy%3D%22172.286%22%20r%3D%2216.5%22%20fill%3D%22%23fff%22/%3E%3Cellipse%20cx%3D%22297.709%22%20cy%3D%22172.642%22%20rx%3D%2211.071%22%20ry%3D%2210.871%22%20fill%3D%22%23105a48%22/%3E%3Ccircle%20cx%3D%22304.104%22%20cy%3D%22167.667%22%20r%3D%224.5%22%20fill%3D%22%23fff%22/%3E%3C/g%3E%3Cpath%20d%3D%22M94.661%2017.032l.893-1.476s.99.714%201.916.925%201.575.114%202.955.114l14.565-.162c1.283-.032%203.085-.762%203.02-3.293s-.373-3.503-.373-3.503l1.283-.487s.52.503.877%201.573.309%201.995.292%202.66-.227%201.541-.227%201.541%201.564-.308%202.359-1.038.823-.779%201.489-1.508.812-.86.812-.86.552-.13.877.26.341.957.065%201.46-1.672%202.206-3.247%203.066-2.76%201.427-3.929%201.768-3.848.73-7.063.714l-10.944-.114s-2.143-.081-3.02-.373-2.241-.973-2.598-1.265z%22%20fill%3D%22%23d36d49%22/%3E%3Cg%20fill%3D%22%23105a48%22%3E%3Cellipse%20cx%3D%2293.052%22%20cy%3D%2243.567%22%20rx%3D%22.869%22%20ry%3D%221.014%22%20transform%3D%22rotate%28341.022%29%22/%3E%3Cellipse%20cx%3D%22104.3%22%20cy%3D%22-16.184%22%20rx%3D%22.865%22%20ry%3D%221.009%22%20transform%3D%22rotate%2814.786%29%22/%3E%3C/g%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
ratzarr    </h1>

                        <div class="docstring"><p>Routines for handling RAT-like columns stored in a Zarr array group.</p>

<p>The raster data model in GDAL includes a Raster Attribute Table (RAT).
Several formats support this, storing the data inside the same raster file.
However, sometimes it is not possible to write back into the file, such as
when the file is stored on AWS S3 storage.</p>

<p>This ratzarr module provides an alternative way to store RAT-like columns
alongside the raster file itself, in a way that allows extra columns to
be written incrementally (i.e. block-by-block), allowing for very large
tables to be built up, both in terms of large row count and large number of
columns. More columns can be added later, as required, and columns can be
deleted individually. Columns can also be resized to a new row count.</p>

<p>The RAT is stored as a set of 1-d arrays in a single Zarr array group
(<a href="https://zarr.dev/">https://zarr.dev/</a>, https://github.com/zarr-developers/zarr-python). Currently,
ratzarr only makes use of the local disk and AWS S3 storage options. It does
not support zipfile storage, as this does not allow for writeable arrays on S3.</p>

<p>Simple usage::</p>

<pre><code>import ratzarr
ratfile = 's3://mybucket/somepath/myrat.zarr'
rz = <a href="#RatZarr">ratzarr.RatZarr</a>(ratfile)
nRows = 1000000
rz.setRowCount(nRows)

# A very boring column
col = numpy.arange(nRows) + 10

rz.createColumn('BoringCol', col.dtype)
rz.writeBlock('BoringCol', col, 0)

# Read it all back
col2 = rz.readBlock('BoringCol', 0, nRows)
</code></pre>

<p>For the RAT to be on local disk, the <code>ratfile</code> should just be an ordinary
path string.</p>

<p>For very large RATs, with large numbers of rows and possibly many columns,
it is often more memory-efficient to work with fixed-size blocks of data.
In this case, it is important to pay attention to the Zarr chunk size. The
default value is 500000, and it can be set before any columns are created
(see <a href="#RatZarr.setChunkSize">RatZarr.setChunkSize</a>). Most importantly, the size of blocks being read
and/or written should be divisible by the chunk size. The simplest way is
often just to choose the block size as a multiple of the default Zarr chunk
size, but other considerations may require directly setting the Zarr chunk
size.</p>

<p>It is intended that all columns have the same length (i.e. number of rows), but
currently it is up to the user to enforce this.</p>
</div>

                        <input id="mod-ratzarr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-ratzarr-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="sd">Routines for handling RAT-like columns stored in a Zarr array group.</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sd">The raster data model in GDAL includes a Raster Attribute Table (RAT).</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="sd">Several formats support this, storing the data inside the same raster file.</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="sd">However, sometimes it is not possible to write back into the file, such as</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="sd">when the file is stored on AWS S3 storage.</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="sd">This ratzarr module provides an alternative way to store RAT-like columns</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="sd">alongside the raster file itself, in a way that allows extra columns to</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="sd">be written incrementally (i.e. block-by-block), allowing for very large</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="sd">tables to be built up, both in terms of large row count and large number of</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="sd">columns. More columns can be added later, as required, and columns can be</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="sd">deleted individually. Columns can also be resized to a new row count.</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="sd">The RAT is stored as a set of 1-d arrays in a single Zarr array group</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="sd">(https://zarr.dev/, https://github.com/zarr-developers/zarr-python). Currently,</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="sd">ratzarr only makes use of the local disk and AWS S3 storage options. It does</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="sd">not support zipfile storage, as this does not allow for writeable arrays on S3.</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="sd">Simple usage::</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="sd">    import ratzarr</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">    ratfile = &#39;s3://mybucket/somepath/myrat.zarr&#39;</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">    rz = ratzarr.RatZarr(ratfile)</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">    nRows = 1000000</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="sd">    rz.setRowCount(nRows)</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">    # A very boring column</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">    col = numpy.arange(nRows) + 10</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">    rz.createColumn(&#39;BoringCol&#39;, col.dtype)</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">    rz.writeBlock(&#39;BoringCol&#39;, col, 0)</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">    # Read it all back</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">    col2 = rz.readBlock(&#39;BoringCol&#39;, 0, nRows)</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">For the RAT to be on local disk, the ``ratfile`` should just be an ordinary</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">path string.</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">For very large RATs, with large numbers of rows and possibly many columns,</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">it is often more memory-efficient to work with fixed-size blocks of data.</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">In this case, it is important to pay attention to the Zarr chunk size. The</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">default value is 500000, and it can be set before any columns are created</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">(see RatZarr.setChunkSize). Most importantly, the size of blocks being read</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">and/or written should be divisible by the chunk size. The simplest way is</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">often just to choose the block size as a multiple of the default Zarr chunk</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">size, but other considerations may require directly setting the Zarr chunk</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">size.</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">It is intended that all columns have the same length (i.e. number of rows), but</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">currently it is up to the user to enforce this.</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">unittest</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">zarr</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="k">try</span><span class="p">:</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">boto3</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>    <span class="n">boto3</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;1.0.0&quot;</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="n">CHUNKSIZE_ATTR</span> <span class="o">=</span> <span class="s1">&#39;CHUNKSIZE&#39;</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="n">DFLT_CHUNKSIZE</span> <span class="o">=</span> <span class="mi">500000</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="k">class</span><span class="w"> </span><span class="nc">RatZarr</span><span class="p">:</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">readOnly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">        This class is a rough equivalent of the GDAL RasterAttributeTable</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">        class, implementing a RAT-like structure with a Zarr group.</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">        It is not supposed to be a drop-in replacement, just something with</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="sd">        somewhat similar functionality.</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="sd">        Parameters</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="sd">        ----------</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">          filename : str</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">            The Zarr file/store to use for the RAT. Can be a local</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">            path string, or a URL for S3, e.g. &#39;s3://bucketname/path&#39;</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">          readOnly : bool</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="sd">            If True, the RAT cannot be modified</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">          create : bool</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="sd">            If True (the default), the RAT will be created if it does not</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">            already exist</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">        The type of each column is a numpy dtype. We do not reproduce GDAL&#39;s</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">        GFT_Integer/Float/String field types, mainly because they seemed to</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">        serve no particular purpose in this context.</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd">        This sort of RAT should not be used for storing things like the</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">        histogram or colour table. For this reason, we do not reproduce the</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a><span class="sd">        concept of column usage, and all columns are effectively GFU_Generic.</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">usingS3</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>        <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;s3://&#39;</span><span class="p">):</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">store</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">FsspecStore</span><span class="o">.</span><span class="n">from_url</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">usingS3</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">store</span> <span class="o">=</span> <span class="n">filename</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">grpName</span> <span class="o">=</span> <span class="s2">&quot;RAT&quot;</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>        <span class="c1"># First a sanity check if the store already exists.</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>        <span class="n">existsWithoutRAT</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>        <span class="n">notExists</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>        <span class="c1">#  Note that we have to test for slightly different exceptions</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>        <span class="c1"># between local and S3, because zarr has inconsistent behaviour.</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>        <span class="n">notExistExc</span> <span class="o">=</span> <span class="ne">FileNotFoundError</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">usingS3</span><span class="p">:</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>            <span class="n">notExistExc</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">GroupNotFoundError</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>            <span class="n">zarr</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>        <span class="k">except</span> <span class="n">notExistExc</span><span class="p">:</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>            <span class="n">notExists</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">notExists</span><span class="p">:</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>                <span class="n">zarr</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grpName</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>            <span class="k">except</span> <span class="n">zarr</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">GroupNotFoundError</span><span class="p">:</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>                <span class="n">existsWithoutRAT</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>        <span class="k">if</span> <span class="n">existsWithoutRAT</span><span class="p">:</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Zarr &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39; exists, but has no RAT group&quot;</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>            <span class="k">raise</span> <span class="n">RatZarrError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>        <span class="k">if</span> <span class="n">notExists</span> <span class="ow">and</span> <span class="n">readOnly</span><span class="p">:</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;readOnly is True, but file &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39; does not exist&quot;</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>            <span class="k">raise</span> <span class="n">RatZarrError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>        <span class="k">if</span> <span class="n">notExists</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">create</span><span class="p">:</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;File &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39; does not exist, but create is False&quot;</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>            <span class="k">raise</span> <span class="n">RatZarrError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>        <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>        <span class="k">if</span> <span class="n">readOnly</span><span class="p">:</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>            <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;r&quot;</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">grp</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">open_group</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grpName</span><span class="p">,</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>                                   <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">columnCache</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>        <span class="c1"># If there are already columns present, find the rowCount</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>        <span class="n">colNameList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grp</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">colNameList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>            <span class="n">colName</span> <span class="o">=</span> <span class="n">colNameList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">openColumn</span><span class="p">(</span><span class="n">colName</span><span class="p">)</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnCache</span><span class="p">[</span><span class="n">colName</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chunksize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grp</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CHUNKSIZE_ATTR</span><span class="p">,</span> <span class="n">DFLT_CHUNKSIZE</span><span class="p">)</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>        <span class="k">if</span> <span class="n">CHUNKSIZE_ATTR</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grp</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">grp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">CHUNKSIZE_ATTR</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunksize</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>        <span class="c1"># Flags to prevent repetitious warning messages</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">blockChunkMultipleWarningDone</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">smallBlockWarningDone</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setRowCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rowCount</span><span class="p">):</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="sd">        Set the number of rows in the RAT.</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a><span class="sd">        Usually do this before creating any columns. The row count persists</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a><span class="sd">        between runs, so this only needs to be set when the RAT is first</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="sd">        created, or if it needs to be changed.</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a><span class="sd">        If there are existing columns, they will be resized to the new</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a><span class="sd">        rowCount. If this less than current, existing columns will be</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="sd">        truncated.</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a><span class="sd">        Parameters</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a><span class="sd">        ----------</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a><span class="sd">          rowCount : int</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a><span class="sd">            The desired number of rows in the RAT</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span> <span class="o">=</span> <span class="n">rowCount</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>        <span class="c1"># Force any existing columns to the new rowCount</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>        <span class="k">for</span> <span class="n">colName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grp</span><span class="p">:</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">openColumn</span><span class="p">(</span><span class="n">colName</span><span class="p">)</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">columnCache</span><span class="p">[</span><span class="n">colName</span><span class="p">]</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="n">rowCount</span><span class="p">,))</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">getRowCount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a><span class="sd">        Returns</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a><span class="sd">        -------</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a><span class="sd">          rowCount : int</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a><span class="sd">            The current number of rows in the RAT</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">colExists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colName</span><span class="p">):</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a><span class="sd">        Return True if the column already exists</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a><span class="sd">        Parameters</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a><span class="sd">        ----------</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a><span class="sd">          colName : str</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a><span class="sd">            Name of column</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">colName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grp</span><span class="p">)</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">getColumnNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a><span class="sd">        Returns</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a><span class="sd">        -------</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a><span class="sd">          colNameList : list of str</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="sd">            List of column names in RAT</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grp</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">createColumn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colName</span><span class="p">,</span> <span class="n">dtype</span><span class="p">):</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a><span class="sd">        Create a new column. Uses the currently active rowCount</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a><span class="sd">        Parameters</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a><span class="sd">        ----------</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a><span class="sd">          colName : str</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a><span class="sd">            Name of column</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a><span class="sd">          dtype : Any numpy dtype</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a><span class="sd">            The data type of the column to create</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">colExists</span><span class="p">(</span><span class="n">colName</span><span class="p">):</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>            <span class="k">raise</span> <span class="n">RatZarrError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column &#39;</span><span class="si">{</span><span class="n">colName</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span><span class="p">)</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>        <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="p">,)</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>        <span class="n">chunkshape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chunksize</span><span class="p">,)</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grp</span><span class="o">.</span><span class="n">create_array</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">colName</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>                                  <span class="n">chunks</span><span class="o">=</span><span class="n">chunkshape</span><span class="p">)</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">columnCache</span><span class="p">[</span><span class="n">colName</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">deleteColumn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colName</span><span class="p">):</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a><span class="sd">        Delete the named column</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a><span class="sd">        Parameters</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a><span class="sd">        ----------</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a><span class="sd">          colName : str</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a><span class="sd">            Name of column</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">grp</span><span class="p">[</span><span class="n">colName</span><span class="p">]</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">openColumn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colName</span><span class="p">):</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a><span class="sd">        Open a cached connection to an existing array on disk.</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a><span class="sd">        This will happen automatically when reading or writing, and users</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a><span class="sd">        should not usually need to call this method.</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a><span class="sd">        Parameters</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a><span class="sd">        ----------</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a><span class="sd">          colName : str</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a><span class="sd">            Name of column</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">colExists</span><span class="p">(</span><span class="n">colName</span><span class="p">):</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Column </span><span class="si">{</span><span class="n">colName</span><span class="si">}</span><span class="s2"> not found in Zarr file </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>            <span class="k">raise</span> <span class="n">RatZarrError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>        <span class="k">if</span> <span class="n">colName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnCache</span><span class="p">:</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>            <span class="n">a</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">open_array</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">,</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>                                <span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">grpName</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">colName</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">columnCache</span><span class="p">[</span><span class="n">colName</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">readBlock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colName</span><span class="p">,</span> <span class="n">startRow</span><span class="p">,</span> <span class="n">blockLen</span><span class="p">):</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a><span class="sd">        Read a block from the given column. Return a numpy array of the</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a><span class="sd">        block.</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a><span class="sd">        To read the entire column, use startRow=0 and blockLen=rowCount.</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a><span class="sd">        For best efficiency, use a block length which is a multiple of the</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a><span class="sd">        chunk size (see getRATChunkSize, getColumnChunkSize).</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a><span class="sd">        If startRow+blockLen is larger than the column length, only</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a><span class="sd">        the available rows are read, and the returned array has this smaller</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a><span class="sd">        size.</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a><span class="sd">        Parameters</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a><span class="sd">        ----------</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a><span class="sd">          colName : str</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a><span class="sd">            Name of column</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a><span class="sd">          startRow : int</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a><span class="sd">            Row of first element to read (starts at 0)</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a><span class="sd">          blockLen : int</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a><span class="sd">            Number of rows to read</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a><span class="sd">        Returns</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a><span class="sd">        -------</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a><span class="sd">          block : ndarray</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a><span class="sd">            1-d numpy array of data for block</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">openColumn</span><span class="p">(</span><span class="n">colName</span><span class="p">)</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>        <span class="n">i1</span> <span class="o">=</span> <span class="n">startRow</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>        <span class="n">i2</span> <span class="o">=</span> <span class="n">startRow</span> <span class="o">+</span> <span class="n">blockLen</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>        <span class="n">block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnCache</span><span class="p">[</span><span class="n">colName</span><span class="p">][</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">]</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>        <span class="k">return</span> <span class="n">block</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">writeBlock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colName</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">startRow</span><span class="p">):</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a><span class="sd">        Write the given block of data into the named column, beginning at</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a><span class="sd">        startRow. For best performance, use a block length which is a</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a><span class="sd">        multiple of the chunk size (see setChunkSize, getRATChunkSize,</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a><span class="sd">        getColumnChunkSize).</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a><span class="sd">        Parameters</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a><span class="sd">        ----------</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a><span class="sd">          colName : str</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a><span class="sd">            Name of column</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a><span class="sd">          block : ndarray</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a><span class="sd">            1-d numpy array</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a><span class="sd">          startRow : int</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a><span class="sd">            Row of first element of block (starts at 0)</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">openColumn</span><span class="p">(</span><span class="n">colName</span><span class="p">)</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>        <span class="n">blockLen</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>        <span class="c1"># Check for chunk size warning conditions</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>        <span class="n">chunksize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnCache</span><span class="p">[</span><span class="n">colName</span><span class="p">]</span><span class="o">.</span><span class="n">chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>        <span class="k">if</span> <span class="n">blockLen</span> <span class="o">&gt;</span> <span class="n">chunksize</span> <span class="ow">and</span> <span class="p">(</span><span class="n">blockLen</span> <span class="o">%</span> <span class="n">chunksize</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Warning: Block len </span><span class="si">{}</span><span class="s2"> not a multiple of &quot;</span> <span class="o">+</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>                   <span class="s2">&quot;chunk size </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">blockLen</span><span class="p">,</span> <span class="n">chunksize</span><span class="p">)</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">blockChunkMultipleWarningDone</span><span class="p">:</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">blockChunkMultipleWarningDone</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>        <span class="k">if</span> <span class="n">blockLen</span> <span class="o">&lt;</span> <span class="n">chunksize</span> <span class="ow">and</span> <span class="p">(</span><span class="n">startRow</span> <span class="o">+</span> <span class="n">blockLen</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="p">:</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Warning: Block len </span><span class="si">{}</span><span class="s2"> smaller than chunk &quot;</span> <span class="o">+</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>                   <span class="s2">&quot;size </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">blockLen</span><span class="p">,</span> <span class="n">chunksize</span><span class="p">)</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">smallBlockWarningDone</span><span class="p">:</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">smallBlockWarningDone</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">startRow</span> <span class="o">+</span> <span class="n">blockLen</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="p">:</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Current rowCount </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="si">}</span><span class="s2"> too small for block of &quot;</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>            <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;length </span><span class="si">{</span><span class="n">blockLen</span><span class="si">}</span><span class="s2"> at startRow </span><span class="si">{</span><span class="n">startRow</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>            <span class="k">raise</span> <span class="n">RatZarrError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>        <span class="n">i1</span> <span class="o">=</span> <span class="n">startRow</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>        <span class="n">i2</span> <span class="o">=</span> <span class="n">startRow</span> <span class="o">+</span> <span class="n">blockLen</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">columnCache</span><span class="p">[</span><span class="n">colName</span><span class="p">][</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">]</span> <span class="o">=</span> <span class="n">block</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setChunkSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunksize</span><span class="p">):</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a><span class="sd">        Set the Zarr chunk size for all columns created after this call.</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a><span class="sd">        This defaults to a sensible value, and should only be changed if</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a><span class="sd">        you know what you are doing. Chunk sizes either too large or too</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a><span class="sd">        small can have performance implications, so proceed with caution.</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a><span class="sd">        The chunk size is preserved in the disk file, and will apply when</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a><span class="sd">        next it is opened. Usually best to set this once, so that all</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a><span class="sd">        columns have the same chunk size.</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a><span class="sd">        When reading and/or writing block-by-block, it is strongly recommended</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a><span class="sd">        that the block length be a multiple of the chunk size, to avoid</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a><span class="sd">        significant performance degradation.</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a><span class="sd">        Parameters</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a><span class="sd">        ----------</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a><span class="sd">          chunksize : int</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a><span class="sd">            Number of rows per chunk</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chunksize</span> <span class="o">=</span> <span class="n">chunksize</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">grp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">CHUNKSIZE_ATTR</span><span class="p">]</span> <span class="o">=</span> <span class="n">chunksize</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">getRATChunkSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a><span class="sd">        Return the chunk size for the RAT.</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">grp</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CHUNKSIZE_ATTR</span><span class="p">,</span> <span class="n">DFLT_CHUNKSIZE</span><span class="p">)</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">getColumnChunkSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colName</span><span class="p">):</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a><span class="sd">        Get the chunk size for the given column. Normally this is the same as</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a><span class="sd">        the chunk size for the whole RAT, but if you suspect it is different,</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a><span class="sd">        use this to check.</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a><span class="sd">        Parameters</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a><span class="sd">        ----------</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a><span class="sd">          colName : str</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a><span class="sd">            Name of column</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a><span class="sd">        Returns</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a><span class="sd">        -------</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a><span class="sd">          chunkSize : int</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a><span class="sd">            The chunk size for the given column (usually set when it was</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a><span class="sd">            created)</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">openColumn</span><span class="p">(</span><span class="n">colName</span><span class="p">)</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>        <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnCache</span><span class="p">[</span><span class="n">colName</span><span class="p">]</span><span class="o">.</span><span class="n">chunks</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>        <span class="k">return</span> <span class="n">chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a><span class="k">class</span><span class="w"> </span><span class="nc">RatZarrError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a><span class="sd">    Generic exception for RatZarr</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a><span class="c1"># Code for unit tests</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a><span class="c1">#</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a><span class="c1">#</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a><span class="n">colNameByType</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>    <span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">:</span> <span class="s1">&#39;int32col&#39;</span><span class="p">,</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>    <span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">:</span> <span class="s1">&#39;float32col&#39;</span><span class="p">,</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>    <span class="n">numpy</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">StringDType</span><span class="p">():</span> <span class="s1">&#39;stringcol&#39;</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a><span class="p">}</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a><span class="k">class</span><span class="w"> </span><span class="nc">AllTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a><span class="sd">    Run all tests</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_simple</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>        <span class="s2">&quot;Test reading/writing/creating a simple RAT&quot;</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>        <span class="n">fn</span> <span class="o">=</span> <span class="s1">&#39;test1.zarr&#39;</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>        <span class="n">fullFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeFilename</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deleteTestFile</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>        <span class="n">rz</span> <span class="o">=</span> <span class="n">RatZarr</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">)</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">setChunkSize</span><span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>        <span class="k">for</span> <span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">colName</span><span class="p">)</span> <span class="ow">in</span> <span class="n">colNameByType</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>            <span class="n">rz</span><span class="o">.</span><span class="n">createColumn</span><span class="p">(</span><span class="n">colName</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>            <span class="n">block</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>            <span class="n">rz</span><span class="o">.</span><span class="n">writeBlock</span><span class="p">(</span><span class="n">colName</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>            <span class="n">rz</span><span class="o">.</span><span class="n">writeBlock</span><span class="p">(</span><span class="n">colName</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>            <span class="n">trueCol</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">block</span><span class="p">,</span> <span class="n">block</span><span class="p">])</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>            <span class="n">col</span> <span class="o">=</span> <span class="n">rz</span><span class="o">.</span><span class="n">readBlock</span><span class="p">(</span><span class="n">colName</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">col</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="s1">&#39;dtype mis-match&#39;</span><span class="p">)</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>            <span class="n">numpy</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_array_equal</span><span class="p">(</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>                <span class="n">col</span><span class="p">,</span> <span class="n">trueCol</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Column data mis-match (dtype=</span><span class="si">{</span><span class="n">block</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deleteTestFile</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>        <span class="s2">&quot;Test a bunch of exception conditions on constructor flags&quot;</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>        <span class="n">fn</span> <span class="o">=</span> <span class="s1">&#39;test1.zarr&#39;</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>        <span class="n">fullFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeFilename</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deleteTestFile</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>        <span class="c1"># readOnly with non-existent file</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">RatZarrError</span><span class="p">):</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="n">RatZarr</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">,</span> <span class="n">readOnly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>        <span class="c1"># create=False with non-existent file</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">RatZarrError</span><span class="p">):</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="n">RatZarr</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deleteTestFile</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_resize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>        <span class="s2">&quot;Reset rowCount&quot;</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>        <span class="n">fn</span> <span class="o">=</span> <span class="s1">&#39;test1.zarr&#39;</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>        <span class="n">fullFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeFilename</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deleteTestFile</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>        <span class="n">rz</span> <span class="o">=</span> <span class="n">RatZarr</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">)</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>        <span class="n">colName</span> <span class="o">=</span> <span class="s1">&#39;col1&#39;</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">createColumn</span><span class="p">(</span><span class="n">colName</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">writeBlock</span><span class="p">(</span><span class="n">colName</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>        <span class="c1"># Resize to smaller</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>        <span class="n">col</span> <span class="o">=</span> <span class="n">rz</span><span class="o">.</span><span class="n">readBlock</span><span class="p">(</span><span class="n">colName</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>            <span class="n">col</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>            <span class="s1">&#39;Truncated rowCount mis-match&#39;</span><span class="p">)</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>        <span class="c1"># Resize bigger</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>        <span class="n">col</span> <span class="o">=</span> <span class="n">rz</span><span class="o">.</span><span class="n">readBlock</span><span class="p">(</span><span class="n">colName</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="s1">&#39;Increased rowCount mis-match&#39;</span><span class="p">)</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deleteTestFile</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_colnames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>        <span class="s2">&quot;Handling column names&quot;</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>        <span class="n">fn</span> <span class="o">=</span> <span class="s1">&#39;test1.zarr&#39;</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>        <span class="n">fullFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeFilename</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deleteTestFile</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>        <span class="n">rz</span> <span class="o">=</span> <span class="n">RatZarr</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">)</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>        <span class="n">col1</span> <span class="o">=</span> <span class="s1">&#39;col1&#39;</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>        <span class="n">col2</span> <span class="o">=</span> <span class="s1">&#39;col2&#39;</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">createColumn</span><span class="p">(</span><span class="n">col1</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">createColumn</span><span class="p">(</span><span class="n">col2</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">rz</span><span class="o">.</span><span class="n">colExists</span><span class="p">(</span><span class="n">col1</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Column &#39;</span><span class="si">{</span><span class="n">col1</span><span class="si">}</span><span class="s2">&#39; does not exist&quot;</span><span class="p">)</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>        <span class="n">colNameList</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">rz</span><span class="o">.</span><span class="n">getColumnNames</span><span class="p">())</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertListEqual</span><span class="p">(</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>            <span class="n">colNameList</span><span class="p">,</span> <span class="p">[</span><span class="n">col1</span><span class="p">,</span> <span class="n">col2</span><span class="p">],</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>            <span class="s1">&#39;Incorrect list of columns&#39;</span><span class="p">)</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>        <span class="c1"># Delete a column</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">deleteColumn</span><span class="p">(</span><span class="n">col1</span><span class="p">)</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">rz</span><span class="o">.</span><span class="n">colExists</span><span class="p">(</span><span class="n">col1</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Column &#39;</span><span class="si">{</span><span class="n">col1</span><span class="si">}</span><span class="s2">&#39; not deleted&quot;</span><span class="p">)</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deleteTestFile</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_chunksize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a>        <span class="s2">&quot;Chunk size manipulation&quot;</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>        <span class="n">fn</span> <span class="o">=</span> <span class="s1">&#39;test1.zarr&#39;</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>        <span class="n">fullFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeFilename</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deleteTestFile</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>        <span class="n">rz</span> <span class="o">=</span> <span class="n">RatZarr</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">)</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>        <span class="n">ratChunk</span> <span class="o">=</span> <span class="n">rz</span><span class="o">.</span><span class="n">getRATChunkSize</span><span class="p">()</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ratChunk</span><span class="p">,</span> <span class="n">DFLT_CHUNKSIZE</span><span class="p">,</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>                         <span class="sa">f</span><span class="s1">&#39;Unexpected chunk size </span><span class="si">{</span><span class="n">ratChunk</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>        <span class="n">newChunk</span> <span class="o">=</span> <span class="mi">100000</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">setChunkSize</span><span class="p">(</span><span class="n">newChunk</span><span class="p">)</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>        <span class="n">ratChunk</span> <span class="o">=</span> <span class="n">rz</span><span class="o">.</span><span class="n">getRATChunkSize</span><span class="p">()</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ratChunk</span><span class="p">,</span> <span class="n">newChunk</span><span class="p">,</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>                         <span class="sa">f</span><span class="s1">&#39;Chunk size not changed: </span><span class="si">{</span><span class="n">ratChunk</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>        <span class="n">colName</span> <span class="o">=</span> <span class="s1">&#39;col1&#39;</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">createColumn</span><span class="p">(</span><span class="n">colName</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>        <span class="n">colChunk</span> <span class="o">=</span> <span class="n">rz</span><span class="o">.</span><span class="n">getColumnChunkSize</span><span class="p">(</span><span class="n">colName</span><span class="p">)</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">colChunk</span><span class="p">,</span> <span class="n">newChunk</span><span class="p">,</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>                         <span class="sa">f</span><span class="s1">&#39;Unexpected column chunk </span><span class="si">{</span><span class="n">colChunk</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>        <span class="n">rz2</span> <span class="o">=</span> <span class="n">RatZarr</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">)</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>        <span class="n">ratChunk</span> <span class="o">=</span> <span class="n">rz2</span><span class="o">.</span><span class="n">getRATChunkSize</span><span class="p">()</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ratChunk</span><span class="p">,</span> <span class="n">newChunk</span><span class="p">,</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>                         <span class="s1">&#39;Chunk size not preserved on disk&#39;</span><span class="p">)</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deleteTestFile</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">makeFilename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a><span class="sd">        Make full filename string</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">s3bucket</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;S3BUCKET&#39;</span><span class="p">)</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">s3bucket</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">boto3</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;S3BUCKET given, boto3 unavailable&quot;</span><span class="p">)</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">usingS3</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s3bucket</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">boto3</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">usingS3</span><span class="p">:</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>            <span class="n">fullFilename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;s3://</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">s3bucket</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>            <span class="n">fullFilename</span> <span class="o">=</span> <span class="n">filename</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>        <span class="k">return</span> <span class="n">fullFilename</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">deleteTestFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a><span class="sd">        Delete the given test file, if it exists</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">usingS3</span><span class="p">:</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a>            <span class="n">s3client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">s3client</span><span class="o">.</span><span class="n">list_objects</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">s3bucket</span><span class="p">,</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a>                                             <span class="n">Prefix</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a>            <span class="k">if</span> <span class="s1">&#39;Contents&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a>                <span class="n">objectKeyList</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;Key&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;Contents&#39;</span><span class="p">]]</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a>                <span class="n">objSpec</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Objects&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;Key&#39;</span><span class="p">:</span> <span class="n">k</span><span class="p">}</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">objectKeyList</span><span class="p">]}</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a>                <span class="n">s3client</span><span class="o">.</span><span class="n">delete_objects</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">s3bucket</span><span class="p">,</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a>                                        <span class="n">Delete</span><span class="o">=</span><span class="n">objSpec</span><span class="p">)</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a>            <span class="c1"># Wait until it is actually gone</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a>            <span class="k">while</span> <span class="s1">&#39;Contents&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a>                <span class="n">response</span> <span class="o">=</span> <span class="n">s3client</span><span class="o">.</span><span class="n">list_objects</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">s3bucket</span><span class="p">,</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a>                                                 <span class="n">Prefix</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a><span class="k">def</span><span class="w"> </span><span class="nf">mainCmd</span><span class="p">():</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a>    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s1">&#39;ratzarr&#39;</span><span class="p">)</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a>    <span class="n">mainCmd</span><span class="p">()</span>
</span></pre></div>


            </section>
                <section id="CHUNKSIZE_ATTR">
                    <div class="attr variable">
            <span class="name">CHUNKSIZE_ATTR</span>        =
<span class="default_value">&#39;CHUNKSIZE&#39;</span>

        
    </div>
    <a class="headerlink" href="#CHUNKSIZE_ATTR"></a>
    
    

                </section>
                <section id="DFLT_CHUNKSIZE">
                    <div class="attr variable">
            <span class="name">DFLT_CHUNKSIZE</span>        =
<span class="default_value">500000</span>

        
    </div>
    <a class="headerlink" href="#DFLT_CHUNKSIZE"></a>
    
    

                </section>
                <section id="RatZarr">
                            <input id="RatZarr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">RatZarr</span>:

                <label class="view-source-button" for="RatZarr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RatZarr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RatZarr-74"><a href="#RatZarr-74"><span class="linenos"> 74</span></a><span class="k">class</span><span class="w"> </span><span class="nc">RatZarr</span><span class="p">:</span>
</span><span id="RatZarr-75"><a href="#RatZarr-75"><span class="linenos"> 75</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">readOnly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="RatZarr-76"><a href="#RatZarr-76"><span class="linenos"> 76</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RatZarr-77"><a href="#RatZarr-77"><span class="linenos"> 77</span></a><span class="sd">        This class is a rough equivalent of the GDAL RasterAttributeTable</span>
</span><span id="RatZarr-78"><a href="#RatZarr-78"><span class="linenos"> 78</span></a><span class="sd">        class, implementing a RAT-like structure with a Zarr group.</span>
</span><span id="RatZarr-79"><a href="#RatZarr-79"><span class="linenos"> 79</span></a><span class="sd">        It is not supposed to be a drop-in replacement, just something with</span>
</span><span id="RatZarr-80"><a href="#RatZarr-80"><span class="linenos"> 80</span></a><span class="sd">        somewhat similar functionality.</span>
</span><span id="RatZarr-81"><a href="#RatZarr-81"><span class="linenos"> 81</span></a>
</span><span id="RatZarr-82"><a href="#RatZarr-82"><span class="linenos"> 82</span></a><span class="sd">        Parameters</span>
</span><span id="RatZarr-83"><a href="#RatZarr-83"><span class="linenos"> 83</span></a><span class="sd">        ----------</span>
</span><span id="RatZarr-84"><a href="#RatZarr-84"><span class="linenos"> 84</span></a><span class="sd">          filename : str</span>
</span><span id="RatZarr-85"><a href="#RatZarr-85"><span class="linenos"> 85</span></a><span class="sd">            The Zarr file/store to use for the RAT. Can be a local</span>
</span><span id="RatZarr-86"><a href="#RatZarr-86"><span class="linenos"> 86</span></a><span class="sd">            path string, or a URL for S3, e.g. &#39;s3://bucketname/path&#39;</span>
</span><span id="RatZarr-87"><a href="#RatZarr-87"><span class="linenos"> 87</span></a><span class="sd">          readOnly : bool</span>
</span><span id="RatZarr-88"><a href="#RatZarr-88"><span class="linenos"> 88</span></a><span class="sd">            If True, the RAT cannot be modified</span>
</span><span id="RatZarr-89"><a href="#RatZarr-89"><span class="linenos"> 89</span></a><span class="sd">          create : bool</span>
</span><span id="RatZarr-90"><a href="#RatZarr-90"><span class="linenos"> 90</span></a><span class="sd">            If True (the default), the RAT will be created if it does not</span>
</span><span id="RatZarr-91"><a href="#RatZarr-91"><span class="linenos"> 91</span></a><span class="sd">            already exist</span>
</span><span id="RatZarr-92"><a href="#RatZarr-92"><span class="linenos"> 92</span></a>
</span><span id="RatZarr-93"><a href="#RatZarr-93"><span class="linenos"> 93</span></a><span class="sd">        The type of each column is a numpy dtype. We do not reproduce GDAL&#39;s</span>
</span><span id="RatZarr-94"><a href="#RatZarr-94"><span class="linenos"> 94</span></a><span class="sd">        GFT_Integer/Float/String field types, mainly because they seemed to</span>
</span><span id="RatZarr-95"><a href="#RatZarr-95"><span class="linenos"> 95</span></a><span class="sd">        serve no particular purpose in this context.</span>
</span><span id="RatZarr-96"><a href="#RatZarr-96"><span class="linenos"> 96</span></a>
</span><span id="RatZarr-97"><a href="#RatZarr-97"><span class="linenos"> 97</span></a><span class="sd">        This sort of RAT should not be used for storing things like the</span>
</span><span id="RatZarr-98"><a href="#RatZarr-98"><span class="linenos"> 98</span></a><span class="sd">        histogram or colour table. For this reason, we do not reproduce the</span>
</span><span id="RatZarr-99"><a href="#RatZarr-99"><span class="linenos"> 99</span></a><span class="sd">        concept of column usage, and all columns are effectively GFU_Generic.</span>
</span><span id="RatZarr-100"><a href="#RatZarr-100"><span class="linenos">100</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RatZarr-101"><a href="#RatZarr-101"><span class="linenos">101</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">usingS3</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="RatZarr-102"><a href="#RatZarr-102"><span class="linenos">102</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
</span><span id="RatZarr-103"><a href="#RatZarr-103"><span class="linenos">103</span></a>        <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;s3://&#39;</span><span class="p">):</span>
</span><span id="RatZarr-104"><a href="#RatZarr-104"><span class="linenos">104</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">store</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">FsspecStore</span><span class="o">.</span><span class="n">from_url</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="RatZarr-105"><a href="#RatZarr-105"><span class="linenos">105</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">usingS3</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="RatZarr-106"><a href="#RatZarr-106"><span class="linenos">106</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="RatZarr-107"><a href="#RatZarr-107"><span class="linenos">107</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">store</span> <span class="o">=</span> <span class="n">filename</span>
</span><span id="RatZarr-108"><a href="#RatZarr-108"><span class="linenos">108</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">grpName</span> <span class="o">=</span> <span class="s2">&quot;RAT&quot;</span>
</span><span id="RatZarr-109"><a href="#RatZarr-109"><span class="linenos">109</span></a>
</span><span id="RatZarr-110"><a href="#RatZarr-110"><span class="linenos">110</span></a>        <span class="c1"># First a sanity check if the store already exists.</span>
</span><span id="RatZarr-111"><a href="#RatZarr-111"><span class="linenos">111</span></a>        <span class="n">existsWithoutRAT</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="RatZarr-112"><a href="#RatZarr-112"><span class="linenos">112</span></a>        <span class="n">notExists</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="RatZarr-113"><a href="#RatZarr-113"><span class="linenos">113</span></a>        <span class="c1">#  Note that we have to test for slightly different exceptions</span>
</span><span id="RatZarr-114"><a href="#RatZarr-114"><span class="linenos">114</span></a>        <span class="c1"># between local and S3, because zarr has inconsistent behaviour.</span>
</span><span id="RatZarr-115"><a href="#RatZarr-115"><span class="linenos">115</span></a>        <span class="n">notExistExc</span> <span class="o">=</span> <span class="ne">FileNotFoundError</span>
</span><span id="RatZarr-116"><a href="#RatZarr-116"><span class="linenos">116</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">usingS3</span><span class="p">:</span>
</span><span id="RatZarr-117"><a href="#RatZarr-117"><span class="linenos">117</span></a>            <span class="n">notExistExc</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">GroupNotFoundError</span>
</span><span id="RatZarr-118"><a href="#RatZarr-118"><span class="linenos">118</span></a>
</span><span id="RatZarr-119"><a href="#RatZarr-119"><span class="linenos">119</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="RatZarr-120"><a href="#RatZarr-120"><span class="linenos">120</span></a>            <span class="n">zarr</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
</span><span id="RatZarr-121"><a href="#RatZarr-121"><span class="linenos">121</span></a>        <span class="k">except</span> <span class="n">notExistExc</span><span class="p">:</span>
</span><span id="RatZarr-122"><a href="#RatZarr-122"><span class="linenos">122</span></a>            <span class="n">notExists</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="RatZarr-123"><a href="#RatZarr-123"><span class="linenos">123</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">notExists</span><span class="p">:</span>
</span><span id="RatZarr-124"><a href="#RatZarr-124"><span class="linenos">124</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="RatZarr-125"><a href="#RatZarr-125"><span class="linenos">125</span></a>                <span class="n">zarr</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grpName</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
</span><span id="RatZarr-126"><a href="#RatZarr-126"><span class="linenos">126</span></a>            <span class="k">except</span> <span class="n">zarr</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">GroupNotFoundError</span><span class="p">:</span>
</span><span id="RatZarr-127"><a href="#RatZarr-127"><span class="linenos">127</span></a>                <span class="n">existsWithoutRAT</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="RatZarr-128"><a href="#RatZarr-128"><span class="linenos">128</span></a>
</span><span id="RatZarr-129"><a href="#RatZarr-129"><span class="linenos">129</span></a>        <span class="k">if</span> <span class="n">existsWithoutRAT</span><span class="p">:</span>
</span><span id="RatZarr-130"><a href="#RatZarr-130"><span class="linenos">130</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Zarr &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39; exists, but has no RAT group&quot;</span>
</span><span id="RatZarr-131"><a href="#RatZarr-131"><span class="linenos">131</span></a>            <span class="k">raise</span> <span class="n">RatZarrError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="RatZarr-132"><a href="#RatZarr-132"><span class="linenos">132</span></a>        <span class="k">if</span> <span class="n">notExists</span> <span class="ow">and</span> <span class="n">readOnly</span><span class="p">:</span>
</span><span id="RatZarr-133"><a href="#RatZarr-133"><span class="linenos">133</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;readOnly is True, but file &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39; does not exist&quot;</span>
</span><span id="RatZarr-134"><a href="#RatZarr-134"><span class="linenos">134</span></a>            <span class="k">raise</span> <span class="n">RatZarrError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="RatZarr-135"><a href="#RatZarr-135"><span class="linenos">135</span></a>        <span class="k">if</span> <span class="n">notExists</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">create</span><span class="p">:</span>
</span><span id="RatZarr-136"><a href="#RatZarr-136"><span class="linenos">136</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;File &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39; does not exist, but create is False&quot;</span>
</span><span id="RatZarr-137"><a href="#RatZarr-137"><span class="linenos">137</span></a>            <span class="k">raise</span> <span class="n">RatZarrError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="RatZarr-138"><a href="#RatZarr-138"><span class="linenos">138</span></a>
</span><span id="RatZarr-139"><a href="#RatZarr-139"><span class="linenos">139</span></a>        <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span>
</span><span id="RatZarr-140"><a href="#RatZarr-140"><span class="linenos">140</span></a>        <span class="k">if</span> <span class="n">readOnly</span><span class="p">:</span>
</span><span id="RatZarr-141"><a href="#RatZarr-141"><span class="linenos">141</span></a>            <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;r&quot;</span>
</span><span id="RatZarr-142"><a href="#RatZarr-142"><span class="linenos">142</span></a>
</span><span id="RatZarr-143"><a href="#RatZarr-143"><span class="linenos">143</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">grp</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">open_group</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grpName</span><span class="p">,</span>
</span><span id="RatZarr-144"><a href="#RatZarr-144"><span class="linenos">144</span></a>                                   <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
</span><span id="RatZarr-145"><a href="#RatZarr-145"><span class="linenos">145</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">columnCache</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="RatZarr-146"><a href="#RatZarr-146"><span class="linenos">146</span></a>
</span><span id="RatZarr-147"><a href="#RatZarr-147"><span class="linenos">147</span></a>        <span class="c1"># If there are already columns present, find the rowCount</span>
</span><span id="RatZarr-148"><a href="#RatZarr-148"><span class="linenos">148</span></a>        <span class="n">colNameList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grp</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="RatZarr-149"><a href="#RatZarr-149"><span class="linenos">149</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">colNameList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="RatZarr-150"><a href="#RatZarr-150"><span class="linenos">150</span></a>            <span class="n">colName</span> <span class="o">=</span> <span class="n">colNameList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="RatZarr-151"><a href="#RatZarr-151"><span class="linenos">151</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">openColumn</span><span class="p">(</span><span class="n">colName</span><span class="p">)</span>
</span><span id="RatZarr-152"><a href="#RatZarr-152"><span class="linenos">152</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnCache</span><span class="p">[</span><span class="n">colName</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="RatZarr-153"><a href="#RatZarr-153"><span class="linenos">153</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="RatZarr-154"><a href="#RatZarr-154"><span class="linenos">154</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="RatZarr-155"><a href="#RatZarr-155"><span class="linenos">155</span></a>
</span><span id="RatZarr-156"><a href="#RatZarr-156"><span class="linenos">156</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chunksize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grp</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CHUNKSIZE_ATTR</span><span class="p">,</span> <span class="n">DFLT_CHUNKSIZE</span><span class="p">)</span>
</span><span id="RatZarr-157"><a href="#RatZarr-157"><span class="linenos">157</span></a>        <span class="k">if</span> <span class="n">CHUNKSIZE_ATTR</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grp</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
</span><span id="RatZarr-158"><a href="#RatZarr-158"><span class="linenos">158</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">grp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">CHUNKSIZE_ATTR</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunksize</span>
</span><span id="RatZarr-159"><a href="#RatZarr-159"><span class="linenos">159</span></a>
</span><span id="RatZarr-160"><a href="#RatZarr-160"><span class="linenos">160</span></a>        <span class="c1"># Flags to prevent repetitious warning messages</span>
</span><span id="RatZarr-161"><a href="#RatZarr-161"><span class="linenos">161</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">blockChunkMultipleWarningDone</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="RatZarr-162"><a href="#RatZarr-162"><span class="linenos">162</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">smallBlockWarningDone</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="RatZarr-163"><a href="#RatZarr-163"><span class="linenos">163</span></a>
</span><span id="RatZarr-164"><a href="#RatZarr-164"><span class="linenos">164</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setRowCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rowCount</span><span class="p">):</span>
</span><span id="RatZarr-165"><a href="#RatZarr-165"><span class="linenos">165</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RatZarr-166"><a href="#RatZarr-166"><span class="linenos">166</span></a><span class="sd">        Set the number of rows in the RAT.</span>
</span><span id="RatZarr-167"><a href="#RatZarr-167"><span class="linenos">167</span></a>
</span><span id="RatZarr-168"><a href="#RatZarr-168"><span class="linenos">168</span></a><span class="sd">        Usually do this before creating any columns. The row count persists</span>
</span><span id="RatZarr-169"><a href="#RatZarr-169"><span class="linenos">169</span></a><span class="sd">        between runs, so this only needs to be set when the RAT is first</span>
</span><span id="RatZarr-170"><a href="#RatZarr-170"><span class="linenos">170</span></a><span class="sd">        created, or if it needs to be changed.</span>
</span><span id="RatZarr-171"><a href="#RatZarr-171"><span class="linenos">171</span></a>
</span><span id="RatZarr-172"><a href="#RatZarr-172"><span class="linenos">172</span></a><span class="sd">        If there are existing columns, they will be resized to the new</span>
</span><span id="RatZarr-173"><a href="#RatZarr-173"><span class="linenos">173</span></a><span class="sd">        rowCount. If this less than current, existing columns will be</span>
</span><span id="RatZarr-174"><a href="#RatZarr-174"><span class="linenos">174</span></a><span class="sd">        truncated.</span>
</span><span id="RatZarr-175"><a href="#RatZarr-175"><span class="linenos">175</span></a>
</span><span id="RatZarr-176"><a href="#RatZarr-176"><span class="linenos">176</span></a><span class="sd">        Parameters</span>
</span><span id="RatZarr-177"><a href="#RatZarr-177"><span class="linenos">177</span></a><span class="sd">        ----------</span>
</span><span id="RatZarr-178"><a href="#RatZarr-178"><span class="linenos">178</span></a><span class="sd">          rowCount : int</span>
</span><span id="RatZarr-179"><a href="#RatZarr-179"><span class="linenos">179</span></a><span class="sd">            The desired number of rows in the RAT</span>
</span><span id="RatZarr-180"><a href="#RatZarr-180"><span class="linenos">180</span></a>
</span><span id="RatZarr-181"><a href="#RatZarr-181"><span class="linenos">181</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RatZarr-182"><a href="#RatZarr-182"><span class="linenos">182</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span> <span class="o">=</span> <span class="n">rowCount</span>
</span><span id="RatZarr-183"><a href="#RatZarr-183"><span class="linenos">183</span></a>
</span><span id="RatZarr-184"><a href="#RatZarr-184"><span class="linenos">184</span></a>        <span class="c1"># Force any existing columns to the new rowCount</span>
</span><span id="RatZarr-185"><a href="#RatZarr-185"><span class="linenos">185</span></a>        <span class="k">for</span> <span class="n">colName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grp</span><span class="p">:</span>
</span><span id="RatZarr-186"><a href="#RatZarr-186"><span class="linenos">186</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">openColumn</span><span class="p">(</span><span class="n">colName</span><span class="p">)</span>
</span><span id="RatZarr-187"><a href="#RatZarr-187"><span class="linenos">187</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">columnCache</span><span class="p">[</span><span class="n">colName</span><span class="p">]</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="n">rowCount</span><span class="p">,))</span>
</span><span id="RatZarr-188"><a href="#RatZarr-188"><span class="linenos">188</span></a>
</span><span id="RatZarr-189"><a href="#RatZarr-189"><span class="linenos">189</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">getRowCount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="RatZarr-190"><a href="#RatZarr-190"><span class="linenos">190</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RatZarr-191"><a href="#RatZarr-191"><span class="linenos">191</span></a><span class="sd">        Returns</span>
</span><span id="RatZarr-192"><a href="#RatZarr-192"><span class="linenos">192</span></a><span class="sd">        -------</span>
</span><span id="RatZarr-193"><a href="#RatZarr-193"><span class="linenos">193</span></a><span class="sd">          rowCount : int</span>
</span><span id="RatZarr-194"><a href="#RatZarr-194"><span class="linenos">194</span></a><span class="sd">            The current number of rows in the RAT</span>
</span><span id="RatZarr-195"><a href="#RatZarr-195"><span class="linenos">195</span></a>
</span><span id="RatZarr-196"><a href="#RatZarr-196"><span class="linenos">196</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RatZarr-197"><a href="#RatZarr-197"><span class="linenos">197</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span>
</span><span id="RatZarr-198"><a href="#RatZarr-198"><span class="linenos">198</span></a>
</span><span id="RatZarr-199"><a href="#RatZarr-199"><span class="linenos">199</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">colExists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colName</span><span class="p">):</span>
</span><span id="RatZarr-200"><a href="#RatZarr-200"><span class="linenos">200</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RatZarr-201"><a href="#RatZarr-201"><span class="linenos">201</span></a><span class="sd">        Return True if the column already exists</span>
</span><span id="RatZarr-202"><a href="#RatZarr-202"><span class="linenos">202</span></a>
</span><span id="RatZarr-203"><a href="#RatZarr-203"><span class="linenos">203</span></a><span class="sd">        Parameters</span>
</span><span id="RatZarr-204"><a href="#RatZarr-204"><span class="linenos">204</span></a><span class="sd">        ----------</span>
</span><span id="RatZarr-205"><a href="#RatZarr-205"><span class="linenos">205</span></a><span class="sd">          colName : str</span>
</span><span id="RatZarr-206"><a href="#RatZarr-206"><span class="linenos">206</span></a><span class="sd">            Name of column</span>
</span><span id="RatZarr-207"><a href="#RatZarr-207"><span class="linenos">207</span></a>
</span><span id="RatZarr-208"><a href="#RatZarr-208"><span class="linenos">208</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RatZarr-209"><a href="#RatZarr-209"><span class="linenos">209</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">colName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grp</span><span class="p">)</span>
</span><span id="RatZarr-210"><a href="#RatZarr-210"><span class="linenos">210</span></a>
</span><span id="RatZarr-211"><a href="#RatZarr-211"><span class="linenos">211</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">getColumnNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="RatZarr-212"><a href="#RatZarr-212"><span class="linenos">212</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RatZarr-213"><a href="#RatZarr-213"><span class="linenos">213</span></a><span class="sd">        Returns</span>
</span><span id="RatZarr-214"><a href="#RatZarr-214"><span class="linenos">214</span></a><span class="sd">        -------</span>
</span><span id="RatZarr-215"><a href="#RatZarr-215"><span class="linenos">215</span></a><span class="sd">          colNameList : list of str</span>
</span><span id="RatZarr-216"><a href="#RatZarr-216"><span class="linenos">216</span></a><span class="sd">            List of column names in RAT</span>
</span><span id="RatZarr-217"><a href="#RatZarr-217"><span class="linenos">217</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RatZarr-218"><a href="#RatZarr-218"><span class="linenos">218</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grp</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="RatZarr-219"><a href="#RatZarr-219"><span class="linenos">219</span></a>
</span><span id="RatZarr-220"><a href="#RatZarr-220"><span class="linenos">220</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">createColumn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colName</span><span class="p">,</span> <span class="n">dtype</span><span class="p">):</span>
</span><span id="RatZarr-221"><a href="#RatZarr-221"><span class="linenos">221</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RatZarr-222"><a href="#RatZarr-222"><span class="linenos">222</span></a><span class="sd">        Create a new column. Uses the currently active rowCount</span>
</span><span id="RatZarr-223"><a href="#RatZarr-223"><span class="linenos">223</span></a>
</span><span id="RatZarr-224"><a href="#RatZarr-224"><span class="linenos">224</span></a><span class="sd">        Parameters</span>
</span><span id="RatZarr-225"><a href="#RatZarr-225"><span class="linenos">225</span></a><span class="sd">        ----------</span>
</span><span id="RatZarr-226"><a href="#RatZarr-226"><span class="linenos">226</span></a><span class="sd">          colName : str</span>
</span><span id="RatZarr-227"><a href="#RatZarr-227"><span class="linenos">227</span></a><span class="sd">            Name of column</span>
</span><span id="RatZarr-228"><a href="#RatZarr-228"><span class="linenos">228</span></a><span class="sd">          dtype : Any numpy dtype</span>
</span><span id="RatZarr-229"><a href="#RatZarr-229"><span class="linenos">229</span></a><span class="sd">            The data type of the column to create</span>
</span><span id="RatZarr-230"><a href="#RatZarr-230"><span class="linenos">230</span></a>
</span><span id="RatZarr-231"><a href="#RatZarr-231"><span class="linenos">231</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RatZarr-232"><a href="#RatZarr-232"><span class="linenos">232</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">colExists</span><span class="p">(</span><span class="n">colName</span><span class="p">):</span>
</span><span id="RatZarr-233"><a href="#RatZarr-233"><span class="linenos">233</span></a>            <span class="k">raise</span> <span class="n">RatZarrError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column &#39;</span><span class="si">{</span><span class="n">colName</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span><span class="p">)</span>
</span><span id="RatZarr-234"><a href="#RatZarr-234"><span class="linenos">234</span></a>
</span><span id="RatZarr-235"><a href="#RatZarr-235"><span class="linenos">235</span></a>        <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="p">,)</span>
</span><span id="RatZarr-236"><a href="#RatZarr-236"><span class="linenos">236</span></a>        <span class="n">chunkshape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chunksize</span><span class="p">,)</span>
</span><span id="RatZarr-237"><a href="#RatZarr-237"><span class="linenos">237</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grp</span><span class="o">.</span><span class="n">create_array</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">colName</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
</span><span id="RatZarr-238"><a href="#RatZarr-238"><span class="linenos">238</span></a>                                  <span class="n">chunks</span><span class="o">=</span><span class="n">chunkshape</span><span class="p">)</span>
</span><span id="RatZarr-239"><a href="#RatZarr-239"><span class="linenos">239</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">columnCache</span><span class="p">[</span><span class="n">colName</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
</span><span id="RatZarr-240"><a href="#RatZarr-240"><span class="linenos">240</span></a>
</span><span id="RatZarr-241"><a href="#RatZarr-241"><span class="linenos">241</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">deleteColumn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colName</span><span class="p">):</span>
</span><span id="RatZarr-242"><a href="#RatZarr-242"><span class="linenos">242</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RatZarr-243"><a href="#RatZarr-243"><span class="linenos">243</span></a><span class="sd">        Delete the named column</span>
</span><span id="RatZarr-244"><a href="#RatZarr-244"><span class="linenos">244</span></a>
</span><span id="RatZarr-245"><a href="#RatZarr-245"><span class="linenos">245</span></a><span class="sd">        Parameters</span>
</span><span id="RatZarr-246"><a href="#RatZarr-246"><span class="linenos">246</span></a><span class="sd">        ----------</span>
</span><span id="RatZarr-247"><a href="#RatZarr-247"><span class="linenos">247</span></a><span class="sd">          colName : str</span>
</span><span id="RatZarr-248"><a href="#RatZarr-248"><span class="linenos">248</span></a><span class="sd">            Name of column</span>
</span><span id="RatZarr-249"><a href="#RatZarr-249"><span class="linenos">249</span></a>
</span><span id="RatZarr-250"><a href="#RatZarr-250"><span class="linenos">250</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RatZarr-251"><a href="#RatZarr-251"><span class="linenos">251</span></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">grp</span><span class="p">[</span><span class="n">colName</span><span class="p">]</span>
</span><span id="RatZarr-252"><a href="#RatZarr-252"><span class="linenos">252</span></a>
</span><span id="RatZarr-253"><a href="#RatZarr-253"><span class="linenos">253</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">openColumn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colName</span><span class="p">):</span>
</span><span id="RatZarr-254"><a href="#RatZarr-254"><span class="linenos">254</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RatZarr-255"><a href="#RatZarr-255"><span class="linenos">255</span></a><span class="sd">        Open a cached connection to an existing array on disk.</span>
</span><span id="RatZarr-256"><a href="#RatZarr-256"><span class="linenos">256</span></a>
</span><span id="RatZarr-257"><a href="#RatZarr-257"><span class="linenos">257</span></a><span class="sd">        This will happen automatically when reading or writing, and users</span>
</span><span id="RatZarr-258"><a href="#RatZarr-258"><span class="linenos">258</span></a><span class="sd">        should not usually need to call this method.</span>
</span><span id="RatZarr-259"><a href="#RatZarr-259"><span class="linenos">259</span></a>
</span><span id="RatZarr-260"><a href="#RatZarr-260"><span class="linenos">260</span></a><span class="sd">        Parameters</span>
</span><span id="RatZarr-261"><a href="#RatZarr-261"><span class="linenos">261</span></a><span class="sd">        ----------</span>
</span><span id="RatZarr-262"><a href="#RatZarr-262"><span class="linenos">262</span></a><span class="sd">          colName : str</span>
</span><span id="RatZarr-263"><a href="#RatZarr-263"><span class="linenos">263</span></a><span class="sd">            Name of column</span>
</span><span id="RatZarr-264"><a href="#RatZarr-264"><span class="linenos">264</span></a>
</span><span id="RatZarr-265"><a href="#RatZarr-265"><span class="linenos">265</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RatZarr-266"><a href="#RatZarr-266"><span class="linenos">266</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">colExists</span><span class="p">(</span><span class="n">colName</span><span class="p">):</span>
</span><span id="RatZarr-267"><a href="#RatZarr-267"><span class="linenos">267</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Column </span><span class="si">{</span><span class="n">colName</span><span class="si">}</span><span class="s2"> not found in Zarr file </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="RatZarr-268"><a href="#RatZarr-268"><span class="linenos">268</span></a>            <span class="k">raise</span> <span class="n">RatZarrError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="RatZarr-269"><a href="#RatZarr-269"><span class="linenos">269</span></a>
</span><span id="RatZarr-270"><a href="#RatZarr-270"><span class="linenos">270</span></a>        <span class="k">if</span> <span class="n">colName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnCache</span><span class="p">:</span>
</span><span id="RatZarr-271"><a href="#RatZarr-271"><span class="linenos">271</span></a>            <span class="n">a</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">open_array</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">,</span>
</span><span id="RatZarr-272"><a href="#RatZarr-272"><span class="linenos">272</span></a>                                <span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">grpName</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">colName</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="RatZarr-273"><a href="#RatZarr-273"><span class="linenos">273</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">columnCache</span><span class="p">[</span><span class="n">colName</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
</span><span id="RatZarr-274"><a href="#RatZarr-274"><span class="linenos">274</span></a>
</span><span id="RatZarr-275"><a href="#RatZarr-275"><span class="linenos">275</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">readBlock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colName</span><span class="p">,</span> <span class="n">startRow</span><span class="p">,</span> <span class="n">blockLen</span><span class="p">):</span>
</span><span id="RatZarr-276"><a href="#RatZarr-276"><span class="linenos">276</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RatZarr-277"><a href="#RatZarr-277"><span class="linenos">277</span></a><span class="sd">        Read a block from the given column. Return a numpy array of the</span>
</span><span id="RatZarr-278"><a href="#RatZarr-278"><span class="linenos">278</span></a><span class="sd">        block.</span>
</span><span id="RatZarr-279"><a href="#RatZarr-279"><span class="linenos">279</span></a>
</span><span id="RatZarr-280"><a href="#RatZarr-280"><span class="linenos">280</span></a><span class="sd">        To read the entire column, use startRow=0 and blockLen=rowCount.</span>
</span><span id="RatZarr-281"><a href="#RatZarr-281"><span class="linenos">281</span></a>
</span><span id="RatZarr-282"><a href="#RatZarr-282"><span class="linenos">282</span></a><span class="sd">        For best efficiency, use a block length which is a multiple of the</span>
</span><span id="RatZarr-283"><a href="#RatZarr-283"><span class="linenos">283</span></a><span class="sd">        chunk size (see getRATChunkSize, getColumnChunkSize).</span>
</span><span id="RatZarr-284"><a href="#RatZarr-284"><span class="linenos">284</span></a>
</span><span id="RatZarr-285"><a href="#RatZarr-285"><span class="linenos">285</span></a><span class="sd">        If startRow+blockLen is larger than the column length, only</span>
</span><span id="RatZarr-286"><a href="#RatZarr-286"><span class="linenos">286</span></a><span class="sd">        the available rows are read, and the returned array has this smaller</span>
</span><span id="RatZarr-287"><a href="#RatZarr-287"><span class="linenos">287</span></a><span class="sd">        size.</span>
</span><span id="RatZarr-288"><a href="#RatZarr-288"><span class="linenos">288</span></a>
</span><span id="RatZarr-289"><a href="#RatZarr-289"><span class="linenos">289</span></a><span class="sd">        Parameters</span>
</span><span id="RatZarr-290"><a href="#RatZarr-290"><span class="linenos">290</span></a><span class="sd">        ----------</span>
</span><span id="RatZarr-291"><a href="#RatZarr-291"><span class="linenos">291</span></a><span class="sd">          colName : str</span>
</span><span id="RatZarr-292"><a href="#RatZarr-292"><span class="linenos">292</span></a><span class="sd">            Name of column</span>
</span><span id="RatZarr-293"><a href="#RatZarr-293"><span class="linenos">293</span></a><span class="sd">          startRow : int</span>
</span><span id="RatZarr-294"><a href="#RatZarr-294"><span class="linenos">294</span></a><span class="sd">            Row of first element to read (starts at 0)</span>
</span><span id="RatZarr-295"><a href="#RatZarr-295"><span class="linenos">295</span></a><span class="sd">          blockLen : int</span>
</span><span id="RatZarr-296"><a href="#RatZarr-296"><span class="linenos">296</span></a><span class="sd">            Number of rows to read</span>
</span><span id="RatZarr-297"><a href="#RatZarr-297"><span class="linenos">297</span></a>
</span><span id="RatZarr-298"><a href="#RatZarr-298"><span class="linenos">298</span></a><span class="sd">        Returns</span>
</span><span id="RatZarr-299"><a href="#RatZarr-299"><span class="linenos">299</span></a><span class="sd">        -------</span>
</span><span id="RatZarr-300"><a href="#RatZarr-300"><span class="linenos">300</span></a><span class="sd">          block : ndarray</span>
</span><span id="RatZarr-301"><a href="#RatZarr-301"><span class="linenos">301</span></a><span class="sd">            1-d numpy array of data for block</span>
</span><span id="RatZarr-302"><a href="#RatZarr-302"><span class="linenos">302</span></a>
</span><span id="RatZarr-303"><a href="#RatZarr-303"><span class="linenos">303</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RatZarr-304"><a href="#RatZarr-304"><span class="linenos">304</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">openColumn</span><span class="p">(</span><span class="n">colName</span><span class="p">)</span>
</span><span id="RatZarr-305"><a href="#RatZarr-305"><span class="linenos">305</span></a>        <span class="n">i1</span> <span class="o">=</span> <span class="n">startRow</span>
</span><span id="RatZarr-306"><a href="#RatZarr-306"><span class="linenos">306</span></a>        <span class="n">i2</span> <span class="o">=</span> <span class="n">startRow</span> <span class="o">+</span> <span class="n">blockLen</span>
</span><span id="RatZarr-307"><a href="#RatZarr-307"><span class="linenos">307</span></a>        <span class="n">block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnCache</span><span class="p">[</span><span class="n">colName</span><span class="p">][</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">]</span>
</span><span id="RatZarr-308"><a href="#RatZarr-308"><span class="linenos">308</span></a>        <span class="k">return</span> <span class="n">block</span>
</span><span id="RatZarr-309"><a href="#RatZarr-309"><span class="linenos">309</span></a>
</span><span id="RatZarr-310"><a href="#RatZarr-310"><span class="linenos">310</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">writeBlock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colName</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">startRow</span><span class="p">):</span>
</span><span id="RatZarr-311"><a href="#RatZarr-311"><span class="linenos">311</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RatZarr-312"><a href="#RatZarr-312"><span class="linenos">312</span></a><span class="sd">        Write the given block of data into the named column, beginning at</span>
</span><span id="RatZarr-313"><a href="#RatZarr-313"><span class="linenos">313</span></a><span class="sd">        startRow. For best performance, use a block length which is a</span>
</span><span id="RatZarr-314"><a href="#RatZarr-314"><span class="linenos">314</span></a><span class="sd">        multiple of the chunk size (see setChunkSize, getRATChunkSize,</span>
</span><span id="RatZarr-315"><a href="#RatZarr-315"><span class="linenos">315</span></a><span class="sd">        getColumnChunkSize).</span>
</span><span id="RatZarr-316"><a href="#RatZarr-316"><span class="linenos">316</span></a>
</span><span id="RatZarr-317"><a href="#RatZarr-317"><span class="linenos">317</span></a><span class="sd">        Parameters</span>
</span><span id="RatZarr-318"><a href="#RatZarr-318"><span class="linenos">318</span></a><span class="sd">        ----------</span>
</span><span id="RatZarr-319"><a href="#RatZarr-319"><span class="linenos">319</span></a><span class="sd">          colName : str</span>
</span><span id="RatZarr-320"><a href="#RatZarr-320"><span class="linenos">320</span></a><span class="sd">            Name of column</span>
</span><span id="RatZarr-321"><a href="#RatZarr-321"><span class="linenos">321</span></a><span class="sd">          block : ndarray</span>
</span><span id="RatZarr-322"><a href="#RatZarr-322"><span class="linenos">322</span></a><span class="sd">            1-d numpy array</span>
</span><span id="RatZarr-323"><a href="#RatZarr-323"><span class="linenos">323</span></a><span class="sd">          startRow : int</span>
</span><span id="RatZarr-324"><a href="#RatZarr-324"><span class="linenos">324</span></a><span class="sd">            Row of first element of block (starts at 0)</span>
</span><span id="RatZarr-325"><a href="#RatZarr-325"><span class="linenos">325</span></a>
</span><span id="RatZarr-326"><a href="#RatZarr-326"><span class="linenos">326</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RatZarr-327"><a href="#RatZarr-327"><span class="linenos">327</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">openColumn</span><span class="p">(</span><span class="n">colName</span><span class="p">)</span>
</span><span id="RatZarr-328"><a href="#RatZarr-328"><span class="linenos">328</span></a>
</span><span id="RatZarr-329"><a href="#RatZarr-329"><span class="linenos">329</span></a>        <span class="n">blockLen</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="RatZarr-330"><a href="#RatZarr-330"><span class="linenos">330</span></a>        <span class="c1"># Check for chunk size warning conditions</span>
</span><span id="RatZarr-331"><a href="#RatZarr-331"><span class="linenos">331</span></a>        <span class="n">chunksize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnCache</span><span class="p">[</span><span class="n">colName</span><span class="p">]</span><span class="o">.</span><span class="n">chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="RatZarr-332"><a href="#RatZarr-332"><span class="linenos">332</span></a>        <span class="k">if</span> <span class="n">blockLen</span> <span class="o">&gt;</span> <span class="n">chunksize</span> <span class="ow">and</span> <span class="p">(</span><span class="n">blockLen</span> <span class="o">%</span> <span class="n">chunksize</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="RatZarr-333"><a href="#RatZarr-333"><span class="linenos">333</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Warning: Block len </span><span class="si">{}</span><span class="s2"> not a multiple of &quot;</span> <span class="o">+</span>
</span><span id="RatZarr-334"><a href="#RatZarr-334"><span class="linenos">334</span></a>                   <span class="s2">&quot;chunk size </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">blockLen</span><span class="p">,</span> <span class="n">chunksize</span><span class="p">)</span>
</span><span id="RatZarr-335"><a href="#RatZarr-335"><span class="linenos">335</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">blockChunkMultipleWarningDone</span><span class="p">:</span>
</span><span id="RatZarr-336"><a href="#RatZarr-336"><span class="linenos">336</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</span><span id="RatZarr-337"><a href="#RatZarr-337"><span class="linenos">337</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">blockChunkMultipleWarningDone</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="RatZarr-338"><a href="#RatZarr-338"><span class="linenos">338</span></a>        <span class="k">if</span> <span class="n">blockLen</span> <span class="o">&lt;</span> <span class="n">chunksize</span> <span class="ow">and</span> <span class="p">(</span><span class="n">startRow</span> <span class="o">+</span> <span class="n">blockLen</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="p">:</span>
</span><span id="RatZarr-339"><a href="#RatZarr-339"><span class="linenos">339</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Warning: Block len </span><span class="si">{}</span><span class="s2"> smaller than chunk &quot;</span> <span class="o">+</span>
</span><span id="RatZarr-340"><a href="#RatZarr-340"><span class="linenos">340</span></a>                   <span class="s2">&quot;size </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">blockLen</span><span class="p">,</span> <span class="n">chunksize</span><span class="p">)</span>
</span><span id="RatZarr-341"><a href="#RatZarr-341"><span class="linenos">341</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">smallBlockWarningDone</span><span class="p">:</span>
</span><span id="RatZarr-342"><a href="#RatZarr-342"><span class="linenos">342</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</span><span id="RatZarr-343"><a href="#RatZarr-343"><span class="linenos">343</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">smallBlockWarningDone</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="RatZarr-344"><a href="#RatZarr-344"><span class="linenos">344</span></a>
</span><span id="RatZarr-345"><a href="#RatZarr-345"><span class="linenos">345</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">startRow</span> <span class="o">+</span> <span class="n">blockLen</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="p">:</span>
</span><span id="RatZarr-346"><a href="#RatZarr-346"><span class="linenos">346</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Current rowCount </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="si">}</span><span class="s2"> too small for block of &quot;</span>
</span><span id="RatZarr-347"><a href="#RatZarr-347"><span class="linenos">347</span></a>            <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;length </span><span class="si">{</span><span class="n">blockLen</span><span class="si">}</span><span class="s2"> at startRow </span><span class="si">{</span><span class="n">startRow</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="RatZarr-348"><a href="#RatZarr-348"><span class="linenos">348</span></a>            <span class="k">raise</span> <span class="n">RatZarrError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="RatZarr-349"><a href="#RatZarr-349"><span class="linenos">349</span></a>
</span><span id="RatZarr-350"><a href="#RatZarr-350"><span class="linenos">350</span></a>        <span class="n">i1</span> <span class="o">=</span> <span class="n">startRow</span>
</span><span id="RatZarr-351"><a href="#RatZarr-351"><span class="linenos">351</span></a>        <span class="n">i2</span> <span class="o">=</span> <span class="n">startRow</span> <span class="o">+</span> <span class="n">blockLen</span>
</span><span id="RatZarr-352"><a href="#RatZarr-352"><span class="linenos">352</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">columnCache</span><span class="p">[</span><span class="n">colName</span><span class="p">][</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">]</span> <span class="o">=</span> <span class="n">block</span>
</span><span id="RatZarr-353"><a href="#RatZarr-353"><span class="linenos">353</span></a>
</span><span id="RatZarr-354"><a href="#RatZarr-354"><span class="linenos">354</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setChunkSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunksize</span><span class="p">):</span>
</span><span id="RatZarr-355"><a href="#RatZarr-355"><span class="linenos">355</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RatZarr-356"><a href="#RatZarr-356"><span class="linenos">356</span></a><span class="sd">        Set the Zarr chunk size for all columns created after this call.</span>
</span><span id="RatZarr-357"><a href="#RatZarr-357"><span class="linenos">357</span></a><span class="sd">        This defaults to a sensible value, and should only be changed if</span>
</span><span id="RatZarr-358"><a href="#RatZarr-358"><span class="linenos">358</span></a><span class="sd">        you know what you are doing. Chunk sizes either too large or too</span>
</span><span id="RatZarr-359"><a href="#RatZarr-359"><span class="linenos">359</span></a><span class="sd">        small can have performance implications, so proceed with caution.</span>
</span><span id="RatZarr-360"><a href="#RatZarr-360"><span class="linenos">360</span></a>
</span><span id="RatZarr-361"><a href="#RatZarr-361"><span class="linenos">361</span></a><span class="sd">        The chunk size is preserved in the disk file, and will apply when</span>
</span><span id="RatZarr-362"><a href="#RatZarr-362"><span class="linenos">362</span></a><span class="sd">        next it is opened. Usually best to set this once, so that all</span>
</span><span id="RatZarr-363"><a href="#RatZarr-363"><span class="linenos">363</span></a><span class="sd">        columns have the same chunk size.</span>
</span><span id="RatZarr-364"><a href="#RatZarr-364"><span class="linenos">364</span></a>
</span><span id="RatZarr-365"><a href="#RatZarr-365"><span class="linenos">365</span></a><span class="sd">        When reading and/or writing block-by-block, it is strongly recommended</span>
</span><span id="RatZarr-366"><a href="#RatZarr-366"><span class="linenos">366</span></a><span class="sd">        that the block length be a multiple of the chunk size, to avoid</span>
</span><span id="RatZarr-367"><a href="#RatZarr-367"><span class="linenos">367</span></a><span class="sd">        significant performance degradation.</span>
</span><span id="RatZarr-368"><a href="#RatZarr-368"><span class="linenos">368</span></a>
</span><span id="RatZarr-369"><a href="#RatZarr-369"><span class="linenos">369</span></a><span class="sd">        Parameters</span>
</span><span id="RatZarr-370"><a href="#RatZarr-370"><span class="linenos">370</span></a><span class="sd">        ----------</span>
</span><span id="RatZarr-371"><a href="#RatZarr-371"><span class="linenos">371</span></a><span class="sd">          chunksize : int</span>
</span><span id="RatZarr-372"><a href="#RatZarr-372"><span class="linenos">372</span></a><span class="sd">            Number of rows per chunk</span>
</span><span id="RatZarr-373"><a href="#RatZarr-373"><span class="linenos">373</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RatZarr-374"><a href="#RatZarr-374"><span class="linenos">374</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chunksize</span> <span class="o">=</span> <span class="n">chunksize</span>
</span><span id="RatZarr-375"><a href="#RatZarr-375"><span class="linenos">375</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RatZarr-376"><a href="#RatZarr-376"><span class="linenos">376</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">grp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">CHUNKSIZE_ATTR</span><span class="p">]</span> <span class="o">=</span> <span class="n">chunksize</span>
</span><span id="RatZarr-377"><a href="#RatZarr-377"><span class="linenos">377</span></a>
</span><span id="RatZarr-378"><a href="#RatZarr-378"><span class="linenos">378</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">getRATChunkSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="RatZarr-379"><a href="#RatZarr-379"><span class="linenos">379</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RatZarr-380"><a href="#RatZarr-380"><span class="linenos">380</span></a><span class="sd">        Return the chunk size for the RAT.</span>
</span><span id="RatZarr-381"><a href="#RatZarr-381"><span class="linenos">381</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RatZarr-382"><a href="#RatZarr-382"><span class="linenos">382</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">grp</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CHUNKSIZE_ATTR</span><span class="p">,</span> <span class="n">DFLT_CHUNKSIZE</span><span class="p">)</span>
</span><span id="RatZarr-383"><a href="#RatZarr-383"><span class="linenos">383</span></a>
</span><span id="RatZarr-384"><a href="#RatZarr-384"><span class="linenos">384</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">getColumnChunkSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colName</span><span class="p">):</span>
</span><span id="RatZarr-385"><a href="#RatZarr-385"><span class="linenos">385</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RatZarr-386"><a href="#RatZarr-386"><span class="linenos">386</span></a><span class="sd">        Get the chunk size for the given column. Normally this is the same as</span>
</span><span id="RatZarr-387"><a href="#RatZarr-387"><span class="linenos">387</span></a><span class="sd">        the chunk size for the whole RAT, but if you suspect it is different,</span>
</span><span id="RatZarr-388"><a href="#RatZarr-388"><span class="linenos">388</span></a><span class="sd">        use this to check.</span>
</span><span id="RatZarr-389"><a href="#RatZarr-389"><span class="linenos">389</span></a>
</span><span id="RatZarr-390"><a href="#RatZarr-390"><span class="linenos">390</span></a><span class="sd">        Parameters</span>
</span><span id="RatZarr-391"><a href="#RatZarr-391"><span class="linenos">391</span></a><span class="sd">        ----------</span>
</span><span id="RatZarr-392"><a href="#RatZarr-392"><span class="linenos">392</span></a><span class="sd">          colName : str</span>
</span><span id="RatZarr-393"><a href="#RatZarr-393"><span class="linenos">393</span></a><span class="sd">            Name of column</span>
</span><span id="RatZarr-394"><a href="#RatZarr-394"><span class="linenos">394</span></a>
</span><span id="RatZarr-395"><a href="#RatZarr-395"><span class="linenos">395</span></a><span class="sd">        Returns</span>
</span><span id="RatZarr-396"><a href="#RatZarr-396"><span class="linenos">396</span></a><span class="sd">        -------</span>
</span><span id="RatZarr-397"><a href="#RatZarr-397"><span class="linenos">397</span></a><span class="sd">          chunkSize : int</span>
</span><span id="RatZarr-398"><a href="#RatZarr-398"><span class="linenos">398</span></a><span class="sd">            The chunk size for the given column (usually set when it was</span>
</span><span id="RatZarr-399"><a href="#RatZarr-399"><span class="linenos">399</span></a><span class="sd">            created)</span>
</span><span id="RatZarr-400"><a href="#RatZarr-400"><span class="linenos">400</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RatZarr-401"><a href="#RatZarr-401"><span class="linenos">401</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">openColumn</span><span class="p">(</span><span class="n">colName</span><span class="p">)</span>
</span><span id="RatZarr-402"><a href="#RatZarr-402"><span class="linenos">402</span></a>        <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnCache</span><span class="p">[</span><span class="n">colName</span><span class="p">]</span><span class="o">.</span><span class="n">chunks</span>
</span><span id="RatZarr-403"><a href="#RatZarr-403"><span class="linenos">403</span></a>        <span class="k">return</span> <span class="n">chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></pre></div>


    

                            <div id="RatZarr.__init__" class="classattr">
                                        <input id="RatZarr.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">RatZarr</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">filename</span>, </span><span class="param"><span class="n">readOnly</span><span class="o">=</span><span class="kc">False</span>, </span><span class="param"><span class="n">create</span><span class="o">=</span><span class="kc">True</span></span>)</span>

                <label class="view-source-button" for="RatZarr.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RatZarr.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RatZarr.__init__-75"><a href="#RatZarr.__init__-75"><span class="linenos"> 75</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">readOnly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="RatZarr.__init__-76"><a href="#RatZarr.__init__-76"><span class="linenos"> 76</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RatZarr.__init__-77"><a href="#RatZarr.__init__-77"><span class="linenos"> 77</span></a><span class="sd">        This class is a rough equivalent of the GDAL RasterAttributeTable</span>
</span><span id="RatZarr.__init__-78"><a href="#RatZarr.__init__-78"><span class="linenos"> 78</span></a><span class="sd">        class, implementing a RAT-like structure with a Zarr group.</span>
</span><span id="RatZarr.__init__-79"><a href="#RatZarr.__init__-79"><span class="linenos"> 79</span></a><span class="sd">        It is not supposed to be a drop-in replacement, just something with</span>
</span><span id="RatZarr.__init__-80"><a href="#RatZarr.__init__-80"><span class="linenos"> 80</span></a><span class="sd">        somewhat similar functionality.</span>
</span><span id="RatZarr.__init__-81"><a href="#RatZarr.__init__-81"><span class="linenos"> 81</span></a>
</span><span id="RatZarr.__init__-82"><a href="#RatZarr.__init__-82"><span class="linenos"> 82</span></a><span class="sd">        Parameters</span>
</span><span id="RatZarr.__init__-83"><a href="#RatZarr.__init__-83"><span class="linenos"> 83</span></a><span class="sd">        ----------</span>
</span><span id="RatZarr.__init__-84"><a href="#RatZarr.__init__-84"><span class="linenos"> 84</span></a><span class="sd">          filename : str</span>
</span><span id="RatZarr.__init__-85"><a href="#RatZarr.__init__-85"><span class="linenos"> 85</span></a><span class="sd">            The Zarr file/store to use for the RAT. Can be a local</span>
</span><span id="RatZarr.__init__-86"><a href="#RatZarr.__init__-86"><span class="linenos"> 86</span></a><span class="sd">            path string, or a URL for S3, e.g. &#39;s3://bucketname/path&#39;</span>
</span><span id="RatZarr.__init__-87"><a href="#RatZarr.__init__-87"><span class="linenos"> 87</span></a><span class="sd">          readOnly : bool</span>
</span><span id="RatZarr.__init__-88"><a href="#RatZarr.__init__-88"><span class="linenos"> 88</span></a><span class="sd">            If True, the RAT cannot be modified</span>
</span><span id="RatZarr.__init__-89"><a href="#RatZarr.__init__-89"><span class="linenos"> 89</span></a><span class="sd">          create : bool</span>
</span><span id="RatZarr.__init__-90"><a href="#RatZarr.__init__-90"><span class="linenos"> 90</span></a><span class="sd">            If True (the default), the RAT will be created if it does not</span>
</span><span id="RatZarr.__init__-91"><a href="#RatZarr.__init__-91"><span class="linenos"> 91</span></a><span class="sd">            already exist</span>
</span><span id="RatZarr.__init__-92"><a href="#RatZarr.__init__-92"><span class="linenos"> 92</span></a>
</span><span id="RatZarr.__init__-93"><a href="#RatZarr.__init__-93"><span class="linenos"> 93</span></a><span class="sd">        The type of each column is a numpy dtype. We do not reproduce GDAL&#39;s</span>
</span><span id="RatZarr.__init__-94"><a href="#RatZarr.__init__-94"><span class="linenos"> 94</span></a><span class="sd">        GFT_Integer/Float/String field types, mainly because they seemed to</span>
</span><span id="RatZarr.__init__-95"><a href="#RatZarr.__init__-95"><span class="linenos"> 95</span></a><span class="sd">        serve no particular purpose in this context.</span>
</span><span id="RatZarr.__init__-96"><a href="#RatZarr.__init__-96"><span class="linenos"> 96</span></a>
</span><span id="RatZarr.__init__-97"><a href="#RatZarr.__init__-97"><span class="linenos"> 97</span></a><span class="sd">        This sort of RAT should not be used for storing things like the</span>
</span><span id="RatZarr.__init__-98"><a href="#RatZarr.__init__-98"><span class="linenos"> 98</span></a><span class="sd">        histogram or colour table. For this reason, we do not reproduce the</span>
</span><span id="RatZarr.__init__-99"><a href="#RatZarr.__init__-99"><span class="linenos"> 99</span></a><span class="sd">        concept of column usage, and all columns are effectively GFU_Generic.</span>
</span><span id="RatZarr.__init__-100"><a href="#RatZarr.__init__-100"><span class="linenos">100</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RatZarr.__init__-101"><a href="#RatZarr.__init__-101"><span class="linenos">101</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">usingS3</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="RatZarr.__init__-102"><a href="#RatZarr.__init__-102"><span class="linenos">102</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
</span><span id="RatZarr.__init__-103"><a href="#RatZarr.__init__-103"><span class="linenos">103</span></a>        <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;s3://&#39;</span><span class="p">):</span>
</span><span id="RatZarr.__init__-104"><a href="#RatZarr.__init__-104"><span class="linenos">104</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">store</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">FsspecStore</span><span class="o">.</span><span class="n">from_url</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="RatZarr.__init__-105"><a href="#RatZarr.__init__-105"><span class="linenos">105</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">usingS3</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="RatZarr.__init__-106"><a href="#RatZarr.__init__-106"><span class="linenos">106</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="RatZarr.__init__-107"><a href="#RatZarr.__init__-107"><span class="linenos">107</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">store</span> <span class="o">=</span> <span class="n">filename</span>
</span><span id="RatZarr.__init__-108"><a href="#RatZarr.__init__-108"><span class="linenos">108</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">grpName</span> <span class="o">=</span> <span class="s2">&quot;RAT&quot;</span>
</span><span id="RatZarr.__init__-109"><a href="#RatZarr.__init__-109"><span class="linenos">109</span></a>
</span><span id="RatZarr.__init__-110"><a href="#RatZarr.__init__-110"><span class="linenos">110</span></a>        <span class="c1"># First a sanity check if the store already exists.</span>
</span><span id="RatZarr.__init__-111"><a href="#RatZarr.__init__-111"><span class="linenos">111</span></a>        <span class="n">existsWithoutRAT</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="RatZarr.__init__-112"><a href="#RatZarr.__init__-112"><span class="linenos">112</span></a>        <span class="n">notExists</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="RatZarr.__init__-113"><a href="#RatZarr.__init__-113"><span class="linenos">113</span></a>        <span class="c1">#  Note that we have to test for slightly different exceptions</span>
</span><span id="RatZarr.__init__-114"><a href="#RatZarr.__init__-114"><span class="linenos">114</span></a>        <span class="c1"># between local and S3, because zarr has inconsistent behaviour.</span>
</span><span id="RatZarr.__init__-115"><a href="#RatZarr.__init__-115"><span class="linenos">115</span></a>        <span class="n">notExistExc</span> <span class="o">=</span> <span class="ne">FileNotFoundError</span>
</span><span id="RatZarr.__init__-116"><a href="#RatZarr.__init__-116"><span class="linenos">116</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">usingS3</span><span class="p">:</span>
</span><span id="RatZarr.__init__-117"><a href="#RatZarr.__init__-117"><span class="linenos">117</span></a>            <span class="n">notExistExc</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">GroupNotFoundError</span>
</span><span id="RatZarr.__init__-118"><a href="#RatZarr.__init__-118"><span class="linenos">118</span></a>
</span><span id="RatZarr.__init__-119"><a href="#RatZarr.__init__-119"><span class="linenos">119</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="RatZarr.__init__-120"><a href="#RatZarr.__init__-120"><span class="linenos">120</span></a>            <span class="n">zarr</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
</span><span id="RatZarr.__init__-121"><a href="#RatZarr.__init__-121"><span class="linenos">121</span></a>        <span class="k">except</span> <span class="n">notExistExc</span><span class="p">:</span>
</span><span id="RatZarr.__init__-122"><a href="#RatZarr.__init__-122"><span class="linenos">122</span></a>            <span class="n">notExists</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="RatZarr.__init__-123"><a href="#RatZarr.__init__-123"><span class="linenos">123</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">notExists</span><span class="p">:</span>
</span><span id="RatZarr.__init__-124"><a href="#RatZarr.__init__-124"><span class="linenos">124</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="RatZarr.__init__-125"><a href="#RatZarr.__init__-125"><span class="linenos">125</span></a>                <span class="n">zarr</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grpName</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
</span><span id="RatZarr.__init__-126"><a href="#RatZarr.__init__-126"><span class="linenos">126</span></a>            <span class="k">except</span> <span class="n">zarr</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">GroupNotFoundError</span><span class="p">:</span>
</span><span id="RatZarr.__init__-127"><a href="#RatZarr.__init__-127"><span class="linenos">127</span></a>                <span class="n">existsWithoutRAT</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="RatZarr.__init__-128"><a href="#RatZarr.__init__-128"><span class="linenos">128</span></a>
</span><span id="RatZarr.__init__-129"><a href="#RatZarr.__init__-129"><span class="linenos">129</span></a>        <span class="k">if</span> <span class="n">existsWithoutRAT</span><span class="p">:</span>
</span><span id="RatZarr.__init__-130"><a href="#RatZarr.__init__-130"><span class="linenos">130</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Zarr &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39; exists, but has no RAT group&quot;</span>
</span><span id="RatZarr.__init__-131"><a href="#RatZarr.__init__-131"><span class="linenos">131</span></a>            <span class="k">raise</span> <span class="n">RatZarrError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="RatZarr.__init__-132"><a href="#RatZarr.__init__-132"><span class="linenos">132</span></a>        <span class="k">if</span> <span class="n">notExists</span> <span class="ow">and</span> <span class="n">readOnly</span><span class="p">:</span>
</span><span id="RatZarr.__init__-133"><a href="#RatZarr.__init__-133"><span class="linenos">133</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;readOnly is True, but file &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39; does not exist&quot;</span>
</span><span id="RatZarr.__init__-134"><a href="#RatZarr.__init__-134"><span class="linenos">134</span></a>            <span class="k">raise</span> <span class="n">RatZarrError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="RatZarr.__init__-135"><a href="#RatZarr.__init__-135"><span class="linenos">135</span></a>        <span class="k">if</span> <span class="n">notExists</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">create</span><span class="p">:</span>
</span><span id="RatZarr.__init__-136"><a href="#RatZarr.__init__-136"><span class="linenos">136</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;File &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39; does not exist, but create is False&quot;</span>
</span><span id="RatZarr.__init__-137"><a href="#RatZarr.__init__-137"><span class="linenos">137</span></a>            <span class="k">raise</span> <span class="n">RatZarrError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="RatZarr.__init__-138"><a href="#RatZarr.__init__-138"><span class="linenos">138</span></a>
</span><span id="RatZarr.__init__-139"><a href="#RatZarr.__init__-139"><span class="linenos">139</span></a>        <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span>
</span><span id="RatZarr.__init__-140"><a href="#RatZarr.__init__-140"><span class="linenos">140</span></a>        <span class="k">if</span> <span class="n">readOnly</span><span class="p">:</span>
</span><span id="RatZarr.__init__-141"><a href="#RatZarr.__init__-141"><span class="linenos">141</span></a>            <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;r&quot;</span>
</span><span id="RatZarr.__init__-142"><a href="#RatZarr.__init__-142"><span class="linenos">142</span></a>
</span><span id="RatZarr.__init__-143"><a href="#RatZarr.__init__-143"><span class="linenos">143</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">grp</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">open_group</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grpName</span><span class="p">,</span>
</span><span id="RatZarr.__init__-144"><a href="#RatZarr.__init__-144"><span class="linenos">144</span></a>                                   <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
</span><span id="RatZarr.__init__-145"><a href="#RatZarr.__init__-145"><span class="linenos">145</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">columnCache</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="RatZarr.__init__-146"><a href="#RatZarr.__init__-146"><span class="linenos">146</span></a>
</span><span id="RatZarr.__init__-147"><a href="#RatZarr.__init__-147"><span class="linenos">147</span></a>        <span class="c1"># If there are already columns present, find the rowCount</span>
</span><span id="RatZarr.__init__-148"><a href="#RatZarr.__init__-148"><span class="linenos">148</span></a>        <span class="n">colNameList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grp</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="RatZarr.__init__-149"><a href="#RatZarr.__init__-149"><span class="linenos">149</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">colNameList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="RatZarr.__init__-150"><a href="#RatZarr.__init__-150"><span class="linenos">150</span></a>            <span class="n">colName</span> <span class="o">=</span> <span class="n">colNameList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="RatZarr.__init__-151"><a href="#RatZarr.__init__-151"><span class="linenos">151</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">openColumn</span><span class="p">(</span><span class="n">colName</span><span class="p">)</span>
</span><span id="RatZarr.__init__-152"><a href="#RatZarr.__init__-152"><span class="linenos">152</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnCache</span><span class="p">[</span><span class="n">colName</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="RatZarr.__init__-153"><a href="#RatZarr.__init__-153"><span class="linenos">153</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="RatZarr.__init__-154"><a href="#RatZarr.__init__-154"><span class="linenos">154</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="RatZarr.__init__-155"><a href="#RatZarr.__init__-155"><span class="linenos">155</span></a>
</span><span id="RatZarr.__init__-156"><a href="#RatZarr.__init__-156"><span class="linenos">156</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chunksize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grp</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CHUNKSIZE_ATTR</span><span class="p">,</span> <span class="n">DFLT_CHUNKSIZE</span><span class="p">)</span>
</span><span id="RatZarr.__init__-157"><a href="#RatZarr.__init__-157"><span class="linenos">157</span></a>        <span class="k">if</span> <span class="n">CHUNKSIZE_ATTR</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grp</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
</span><span id="RatZarr.__init__-158"><a href="#RatZarr.__init__-158"><span class="linenos">158</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">grp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">CHUNKSIZE_ATTR</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunksize</span>
</span><span id="RatZarr.__init__-159"><a href="#RatZarr.__init__-159"><span class="linenos">159</span></a>
</span><span id="RatZarr.__init__-160"><a href="#RatZarr.__init__-160"><span class="linenos">160</span></a>        <span class="c1"># Flags to prevent repetitious warning messages</span>
</span><span id="RatZarr.__init__-161"><a href="#RatZarr.__init__-161"><span class="linenos">161</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">blockChunkMultipleWarningDone</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="RatZarr.__init__-162"><a href="#RatZarr.__init__-162"><span class="linenos">162</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">smallBlockWarningDone</span> <span class="o">=</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>This class is a rough equivalent of the GDAL RasterAttributeTable
class, implementing a RAT-like structure with a Zarr group.
It is not supposed to be a drop-in replacement, just something with
somewhat similar functionality.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>filename</strong> (str):
The Zarr file/store to use for the RAT. Can be a local
path string, or a URL for S3, e.g. 's3://bucketname/path'</li>
<li><strong>readOnly</strong> (bool):
If True, the RAT cannot be modified</li>
<li><strong>create</strong> (bool):
If True (the default), the RAT will be created if it does not
already exist</li>
</ul>

<p>The type of each column is a numpy dtype. We do not reproduce GDAL's
GFT_Integer/Float/String field types, mainly because they seemed to
serve no particular purpose in this context.</p>

<p>This sort of RAT should not be used for storing things like the
histogram or colour table. For this reason, we do not reproduce the
concept of column usage, and all columns are effectively GFU_Generic.</p>
</div>


                            </div>
                            <div id="RatZarr.usingS3" class="classattr">
                                <div class="attr variable">
            <span class="name">usingS3</span>

        
    </div>
    <a class="headerlink" href="#RatZarr.usingS3"></a>
    
    

                            </div>
                            <div id="RatZarr.filename" class="classattr">
                                <div class="attr variable">
            <span class="name">filename</span>

        
    </div>
    <a class="headerlink" href="#RatZarr.filename"></a>
    
    

                            </div>
                            <div id="RatZarr.grpName" class="classattr">
                                <div class="attr variable">
            <span class="name">grpName</span>

        
    </div>
    <a class="headerlink" href="#RatZarr.grpName"></a>
    
    

                            </div>
                            <div id="RatZarr.grp" class="classattr">
                                <div class="attr variable">
            <span class="name">grp</span>

        
    </div>
    <a class="headerlink" href="#RatZarr.grp"></a>
    
    

                            </div>
                            <div id="RatZarr.columnCache" class="classattr">
                                <div class="attr variable">
            <span class="name">columnCache</span>

        
    </div>
    <a class="headerlink" href="#RatZarr.columnCache"></a>
    
    

                            </div>
                            <div id="RatZarr.chunksize" class="classattr">
                                <div class="attr variable">
            <span class="name">chunksize</span>

        
    </div>
    <a class="headerlink" href="#RatZarr.chunksize"></a>
    
    

                            </div>
                            <div id="RatZarr.blockChunkMultipleWarningDone" class="classattr">
                                <div class="attr variable">
            <span class="name">blockChunkMultipleWarningDone</span>

        
    </div>
    <a class="headerlink" href="#RatZarr.blockChunkMultipleWarningDone"></a>
    
    

                            </div>
                            <div id="RatZarr.smallBlockWarningDone" class="classattr">
                                <div class="attr variable">
            <span class="name">smallBlockWarningDone</span>

        
    </div>
    <a class="headerlink" href="#RatZarr.smallBlockWarningDone"></a>
    
    

                            </div>
                            <div id="RatZarr.setRowCount" class="classattr">
                                        <input id="RatZarr.setRowCount-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">setRowCount</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">rowCount</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="RatZarr.setRowCount-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RatZarr.setRowCount"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RatZarr.setRowCount-164"><a href="#RatZarr.setRowCount-164"><span class="linenos">164</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setRowCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rowCount</span><span class="p">):</span>
</span><span id="RatZarr.setRowCount-165"><a href="#RatZarr.setRowCount-165"><span class="linenos">165</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RatZarr.setRowCount-166"><a href="#RatZarr.setRowCount-166"><span class="linenos">166</span></a><span class="sd">        Set the number of rows in the RAT.</span>
</span><span id="RatZarr.setRowCount-167"><a href="#RatZarr.setRowCount-167"><span class="linenos">167</span></a>
</span><span id="RatZarr.setRowCount-168"><a href="#RatZarr.setRowCount-168"><span class="linenos">168</span></a><span class="sd">        Usually do this before creating any columns. The row count persists</span>
</span><span id="RatZarr.setRowCount-169"><a href="#RatZarr.setRowCount-169"><span class="linenos">169</span></a><span class="sd">        between runs, so this only needs to be set when the RAT is first</span>
</span><span id="RatZarr.setRowCount-170"><a href="#RatZarr.setRowCount-170"><span class="linenos">170</span></a><span class="sd">        created, or if it needs to be changed.</span>
</span><span id="RatZarr.setRowCount-171"><a href="#RatZarr.setRowCount-171"><span class="linenos">171</span></a>
</span><span id="RatZarr.setRowCount-172"><a href="#RatZarr.setRowCount-172"><span class="linenos">172</span></a><span class="sd">        If there are existing columns, they will be resized to the new</span>
</span><span id="RatZarr.setRowCount-173"><a href="#RatZarr.setRowCount-173"><span class="linenos">173</span></a><span class="sd">        rowCount. If this less than current, existing columns will be</span>
</span><span id="RatZarr.setRowCount-174"><a href="#RatZarr.setRowCount-174"><span class="linenos">174</span></a><span class="sd">        truncated.</span>
</span><span id="RatZarr.setRowCount-175"><a href="#RatZarr.setRowCount-175"><span class="linenos">175</span></a>
</span><span id="RatZarr.setRowCount-176"><a href="#RatZarr.setRowCount-176"><span class="linenos">176</span></a><span class="sd">        Parameters</span>
</span><span id="RatZarr.setRowCount-177"><a href="#RatZarr.setRowCount-177"><span class="linenos">177</span></a><span class="sd">        ----------</span>
</span><span id="RatZarr.setRowCount-178"><a href="#RatZarr.setRowCount-178"><span class="linenos">178</span></a><span class="sd">          rowCount : int</span>
</span><span id="RatZarr.setRowCount-179"><a href="#RatZarr.setRowCount-179"><span class="linenos">179</span></a><span class="sd">            The desired number of rows in the RAT</span>
</span><span id="RatZarr.setRowCount-180"><a href="#RatZarr.setRowCount-180"><span class="linenos">180</span></a>
</span><span id="RatZarr.setRowCount-181"><a href="#RatZarr.setRowCount-181"><span class="linenos">181</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RatZarr.setRowCount-182"><a href="#RatZarr.setRowCount-182"><span class="linenos">182</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span> <span class="o">=</span> <span class="n">rowCount</span>
</span><span id="RatZarr.setRowCount-183"><a href="#RatZarr.setRowCount-183"><span class="linenos">183</span></a>
</span><span id="RatZarr.setRowCount-184"><a href="#RatZarr.setRowCount-184"><span class="linenos">184</span></a>        <span class="c1"># Force any existing columns to the new rowCount</span>
</span><span id="RatZarr.setRowCount-185"><a href="#RatZarr.setRowCount-185"><span class="linenos">185</span></a>        <span class="k">for</span> <span class="n">colName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grp</span><span class="p">:</span>
</span><span id="RatZarr.setRowCount-186"><a href="#RatZarr.setRowCount-186"><span class="linenos">186</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">openColumn</span><span class="p">(</span><span class="n">colName</span><span class="p">)</span>
</span><span id="RatZarr.setRowCount-187"><a href="#RatZarr.setRowCount-187"><span class="linenos">187</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">columnCache</span><span class="p">[</span><span class="n">colName</span><span class="p">]</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="n">rowCount</span><span class="p">,))</span>
</span></pre></div>


            <div class="docstring"><p>Set the number of rows in the RAT.</p>

<p>Usually do this before creating any columns. The row count persists
between runs, so this only needs to be set when the RAT is first
created, or if it needs to be changed.</p>

<p>If there are existing columns, they will be resized to the new
rowCount. If this less than current, existing columns will be
truncated.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>rowCount</strong> (int):
The desired number of rows in the RAT</li>
</ul>
</div>


                            </div>
                            <div id="RatZarr.getRowCount" class="classattr">
                                        <input id="RatZarr.getRowCount-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">getRowCount</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="RatZarr.getRowCount-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RatZarr.getRowCount"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RatZarr.getRowCount-189"><a href="#RatZarr.getRowCount-189"><span class="linenos">189</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">getRowCount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="RatZarr.getRowCount-190"><a href="#RatZarr.getRowCount-190"><span class="linenos">190</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RatZarr.getRowCount-191"><a href="#RatZarr.getRowCount-191"><span class="linenos">191</span></a><span class="sd">        Returns</span>
</span><span id="RatZarr.getRowCount-192"><a href="#RatZarr.getRowCount-192"><span class="linenos">192</span></a><span class="sd">        -------</span>
</span><span id="RatZarr.getRowCount-193"><a href="#RatZarr.getRowCount-193"><span class="linenos">193</span></a><span class="sd">          rowCount : int</span>
</span><span id="RatZarr.getRowCount-194"><a href="#RatZarr.getRowCount-194"><span class="linenos">194</span></a><span class="sd">            The current number of rows in the RAT</span>
</span><span id="RatZarr.getRowCount-195"><a href="#RatZarr.getRowCount-195"><span class="linenos">195</span></a>
</span><span id="RatZarr.getRowCount-196"><a href="#RatZarr.getRowCount-196"><span class="linenos">196</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RatZarr.getRowCount-197"><a href="#RatZarr.getRowCount-197"><span class="linenos">197</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span>
</span></pre></div>


            <div class="docstring"><h6 id="returns">Returns</h6>

<ul>
<li><strong>rowCount</strong> (int):
The current number of rows in the RAT</li>
</ul>
</div>


                            </div>
                            <div id="RatZarr.colExists" class="classattr">
                                        <input id="RatZarr.colExists-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">colExists</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">colName</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="RatZarr.colExists-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RatZarr.colExists"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RatZarr.colExists-199"><a href="#RatZarr.colExists-199"><span class="linenos">199</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">colExists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colName</span><span class="p">):</span>
</span><span id="RatZarr.colExists-200"><a href="#RatZarr.colExists-200"><span class="linenos">200</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RatZarr.colExists-201"><a href="#RatZarr.colExists-201"><span class="linenos">201</span></a><span class="sd">        Return True if the column already exists</span>
</span><span id="RatZarr.colExists-202"><a href="#RatZarr.colExists-202"><span class="linenos">202</span></a>
</span><span id="RatZarr.colExists-203"><a href="#RatZarr.colExists-203"><span class="linenos">203</span></a><span class="sd">        Parameters</span>
</span><span id="RatZarr.colExists-204"><a href="#RatZarr.colExists-204"><span class="linenos">204</span></a><span class="sd">        ----------</span>
</span><span id="RatZarr.colExists-205"><a href="#RatZarr.colExists-205"><span class="linenos">205</span></a><span class="sd">          colName : str</span>
</span><span id="RatZarr.colExists-206"><a href="#RatZarr.colExists-206"><span class="linenos">206</span></a><span class="sd">            Name of column</span>
</span><span id="RatZarr.colExists-207"><a href="#RatZarr.colExists-207"><span class="linenos">207</span></a>
</span><span id="RatZarr.colExists-208"><a href="#RatZarr.colExists-208"><span class="linenos">208</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RatZarr.colExists-209"><a href="#RatZarr.colExists-209"><span class="linenos">209</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">colName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grp</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return True if the column already exists</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>colName</strong> (str):
Name of column</li>
</ul>
</div>


                            </div>
                            <div id="RatZarr.getColumnNames" class="classattr">
                                        <input id="RatZarr.getColumnNames-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">getColumnNames</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="RatZarr.getColumnNames-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RatZarr.getColumnNames"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RatZarr.getColumnNames-211"><a href="#RatZarr.getColumnNames-211"><span class="linenos">211</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">getColumnNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="RatZarr.getColumnNames-212"><a href="#RatZarr.getColumnNames-212"><span class="linenos">212</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RatZarr.getColumnNames-213"><a href="#RatZarr.getColumnNames-213"><span class="linenos">213</span></a><span class="sd">        Returns</span>
</span><span id="RatZarr.getColumnNames-214"><a href="#RatZarr.getColumnNames-214"><span class="linenos">214</span></a><span class="sd">        -------</span>
</span><span id="RatZarr.getColumnNames-215"><a href="#RatZarr.getColumnNames-215"><span class="linenos">215</span></a><span class="sd">          colNameList : list of str</span>
</span><span id="RatZarr.getColumnNames-216"><a href="#RatZarr.getColumnNames-216"><span class="linenos">216</span></a><span class="sd">            List of column names in RAT</span>
</span><span id="RatZarr.getColumnNames-217"><a href="#RatZarr.getColumnNames-217"><span class="linenos">217</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RatZarr.getColumnNames-218"><a href="#RatZarr.getColumnNames-218"><span class="linenos">218</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grp</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><h6 id="returns">Returns</h6>

<ul>
<li><strong>colNameList</strong> (list of str):
List of column names in RAT</li>
</ul>
</div>


                            </div>
                            <div id="RatZarr.createColumn" class="classattr">
                                        <input id="RatZarr.createColumn-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">createColumn</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">colName</span>, </span><span class="param"><span class="n">dtype</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="RatZarr.createColumn-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RatZarr.createColumn"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RatZarr.createColumn-220"><a href="#RatZarr.createColumn-220"><span class="linenos">220</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">createColumn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colName</span><span class="p">,</span> <span class="n">dtype</span><span class="p">):</span>
</span><span id="RatZarr.createColumn-221"><a href="#RatZarr.createColumn-221"><span class="linenos">221</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RatZarr.createColumn-222"><a href="#RatZarr.createColumn-222"><span class="linenos">222</span></a><span class="sd">        Create a new column. Uses the currently active rowCount</span>
</span><span id="RatZarr.createColumn-223"><a href="#RatZarr.createColumn-223"><span class="linenos">223</span></a>
</span><span id="RatZarr.createColumn-224"><a href="#RatZarr.createColumn-224"><span class="linenos">224</span></a><span class="sd">        Parameters</span>
</span><span id="RatZarr.createColumn-225"><a href="#RatZarr.createColumn-225"><span class="linenos">225</span></a><span class="sd">        ----------</span>
</span><span id="RatZarr.createColumn-226"><a href="#RatZarr.createColumn-226"><span class="linenos">226</span></a><span class="sd">          colName : str</span>
</span><span id="RatZarr.createColumn-227"><a href="#RatZarr.createColumn-227"><span class="linenos">227</span></a><span class="sd">            Name of column</span>
</span><span id="RatZarr.createColumn-228"><a href="#RatZarr.createColumn-228"><span class="linenos">228</span></a><span class="sd">          dtype : Any numpy dtype</span>
</span><span id="RatZarr.createColumn-229"><a href="#RatZarr.createColumn-229"><span class="linenos">229</span></a><span class="sd">            The data type of the column to create</span>
</span><span id="RatZarr.createColumn-230"><a href="#RatZarr.createColumn-230"><span class="linenos">230</span></a>
</span><span id="RatZarr.createColumn-231"><a href="#RatZarr.createColumn-231"><span class="linenos">231</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RatZarr.createColumn-232"><a href="#RatZarr.createColumn-232"><span class="linenos">232</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">colExists</span><span class="p">(</span><span class="n">colName</span><span class="p">):</span>
</span><span id="RatZarr.createColumn-233"><a href="#RatZarr.createColumn-233"><span class="linenos">233</span></a>            <span class="k">raise</span> <span class="n">RatZarrError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column &#39;</span><span class="si">{</span><span class="n">colName</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span><span class="p">)</span>
</span><span id="RatZarr.createColumn-234"><a href="#RatZarr.createColumn-234"><span class="linenos">234</span></a>
</span><span id="RatZarr.createColumn-235"><a href="#RatZarr.createColumn-235"><span class="linenos">235</span></a>        <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="p">,)</span>
</span><span id="RatZarr.createColumn-236"><a href="#RatZarr.createColumn-236"><span class="linenos">236</span></a>        <span class="n">chunkshape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chunksize</span><span class="p">,)</span>
</span><span id="RatZarr.createColumn-237"><a href="#RatZarr.createColumn-237"><span class="linenos">237</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grp</span><span class="o">.</span><span class="n">create_array</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">colName</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
</span><span id="RatZarr.createColumn-238"><a href="#RatZarr.createColumn-238"><span class="linenos">238</span></a>                                  <span class="n">chunks</span><span class="o">=</span><span class="n">chunkshape</span><span class="p">)</span>
</span><span id="RatZarr.createColumn-239"><a href="#RatZarr.createColumn-239"><span class="linenos">239</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">columnCache</span><span class="p">[</span><span class="n">colName</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
</span></pre></div>


            <div class="docstring"><p>Create a new column. Uses the currently active rowCount</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>colName</strong> (str):
Name of column</li>
<li><strong>dtype</strong> (Any numpy dtype):
The data type of the column to create</li>
</ul>
</div>


                            </div>
                            <div id="RatZarr.deleteColumn" class="classattr">
                                        <input id="RatZarr.deleteColumn-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">deleteColumn</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">colName</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="RatZarr.deleteColumn-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RatZarr.deleteColumn"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RatZarr.deleteColumn-241"><a href="#RatZarr.deleteColumn-241"><span class="linenos">241</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">deleteColumn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colName</span><span class="p">):</span>
</span><span id="RatZarr.deleteColumn-242"><a href="#RatZarr.deleteColumn-242"><span class="linenos">242</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RatZarr.deleteColumn-243"><a href="#RatZarr.deleteColumn-243"><span class="linenos">243</span></a><span class="sd">        Delete the named column</span>
</span><span id="RatZarr.deleteColumn-244"><a href="#RatZarr.deleteColumn-244"><span class="linenos">244</span></a>
</span><span id="RatZarr.deleteColumn-245"><a href="#RatZarr.deleteColumn-245"><span class="linenos">245</span></a><span class="sd">        Parameters</span>
</span><span id="RatZarr.deleteColumn-246"><a href="#RatZarr.deleteColumn-246"><span class="linenos">246</span></a><span class="sd">        ----------</span>
</span><span id="RatZarr.deleteColumn-247"><a href="#RatZarr.deleteColumn-247"><span class="linenos">247</span></a><span class="sd">          colName : str</span>
</span><span id="RatZarr.deleteColumn-248"><a href="#RatZarr.deleteColumn-248"><span class="linenos">248</span></a><span class="sd">            Name of column</span>
</span><span id="RatZarr.deleteColumn-249"><a href="#RatZarr.deleteColumn-249"><span class="linenos">249</span></a>
</span><span id="RatZarr.deleteColumn-250"><a href="#RatZarr.deleteColumn-250"><span class="linenos">250</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RatZarr.deleteColumn-251"><a href="#RatZarr.deleteColumn-251"><span class="linenos">251</span></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">grp</span><span class="p">[</span><span class="n">colName</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Delete the named column</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>colName</strong> (str):
Name of column</li>
</ul>
</div>


                            </div>
                            <div id="RatZarr.openColumn" class="classattr">
                                        <input id="RatZarr.openColumn-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">openColumn</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">colName</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="RatZarr.openColumn-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RatZarr.openColumn"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RatZarr.openColumn-253"><a href="#RatZarr.openColumn-253"><span class="linenos">253</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">openColumn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colName</span><span class="p">):</span>
</span><span id="RatZarr.openColumn-254"><a href="#RatZarr.openColumn-254"><span class="linenos">254</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RatZarr.openColumn-255"><a href="#RatZarr.openColumn-255"><span class="linenos">255</span></a><span class="sd">        Open a cached connection to an existing array on disk.</span>
</span><span id="RatZarr.openColumn-256"><a href="#RatZarr.openColumn-256"><span class="linenos">256</span></a>
</span><span id="RatZarr.openColumn-257"><a href="#RatZarr.openColumn-257"><span class="linenos">257</span></a><span class="sd">        This will happen automatically when reading or writing, and users</span>
</span><span id="RatZarr.openColumn-258"><a href="#RatZarr.openColumn-258"><span class="linenos">258</span></a><span class="sd">        should not usually need to call this method.</span>
</span><span id="RatZarr.openColumn-259"><a href="#RatZarr.openColumn-259"><span class="linenos">259</span></a>
</span><span id="RatZarr.openColumn-260"><a href="#RatZarr.openColumn-260"><span class="linenos">260</span></a><span class="sd">        Parameters</span>
</span><span id="RatZarr.openColumn-261"><a href="#RatZarr.openColumn-261"><span class="linenos">261</span></a><span class="sd">        ----------</span>
</span><span id="RatZarr.openColumn-262"><a href="#RatZarr.openColumn-262"><span class="linenos">262</span></a><span class="sd">          colName : str</span>
</span><span id="RatZarr.openColumn-263"><a href="#RatZarr.openColumn-263"><span class="linenos">263</span></a><span class="sd">            Name of column</span>
</span><span id="RatZarr.openColumn-264"><a href="#RatZarr.openColumn-264"><span class="linenos">264</span></a>
</span><span id="RatZarr.openColumn-265"><a href="#RatZarr.openColumn-265"><span class="linenos">265</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RatZarr.openColumn-266"><a href="#RatZarr.openColumn-266"><span class="linenos">266</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">colExists</span><span class="p">(</span><span class="n">colName</span><span class="p">):</span>
</span><span id="RatZarr.openColumn-267"><a href="#RatZarr.openColumn-267"><span class="linenos">267</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Column </span><span class="si">{</span><span class="n">colName</span><span class="si">}</span><span class="s2"> not found in Zarr file </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="RatZarr.openColumn-268"><a href="#RatZarr.openColumn-268"><span class="linenos">268</span></a>            <span class="k">raise</span> <span class="n">RatZarrError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="RatZarr.openColumn-269"><a href="#RatZarr.openColumn-269"><span class="linenos">269</span></a>
</span><span id="RatZarr.openColumn-270"><a href="#RatZarr.openColumn-270"><span class="linenos">270</span></a>        <span class="k">if</span> <span class="n">colName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnCache</span><span class="p">:</span>
</span><span id="RatZarr.openColumn-271"><a href="#RatZarr.openColumn-271"><span class="linenos">271</span></a>            <span class="n">a</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">open_array</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">,</span>
</span><span id="RatZarr.openColumn-272"><a href="#RatZarr.openColumn-272"><span class="linenos">272</span></a>                                <span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">grpName</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">colName</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="RatZarr.openColumn-273"><a href="#RatZarr.openColumn-273"><span class="linenos">273</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">columnCache</span><span class="p">[</span><span class="n">colName</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
</span></pre></div>


            <div class="docstring"><p>Open a cached connection to an existing array on disk.</p>

<p>This will happen automatically when reading or writing, and users
should not usually need to call this method.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>colName</strong> (str):
Name of column</li>
</ul>
</div>


                            </div>
                            <div id="RatZarr.readBlock" class="classattr">
                                        <input id="RatZarr.readBlock-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">readBlock</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">colName</span>, </span><span class="param"><span class="n">startRow</span>, </span><span class="param"><span class="n">blockLen</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="RatZarr.readBlock-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RatZarr.readBlock"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RatZarr.readBlock-275"><a href="#RatZarr.readBlock-275"><span class="linenos">275</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">readBlock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colName</span><span class="p">,</span> <span class="n">startRow</span><span class="p">,</span> <span class="n">blockLen</span><span class="p">):</span>
</span><span id="RatZarr.readBlock-276"><a href="#RatZarr.readBlock-276"><span class="linenos">276</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RatZarr.readBlock-277"><a href="#RatZarr.readBlock-277"><span class="linenos">277</span></a><span class="sd">        Read a block from the given column. Return a numpy array of the</span>
</span><span id="RatZarr.readBlock-278"><a href="#RatZarr.readBlock-278"><span class="linenos">278</span></a><span class="sd">        block.</span>
</span><span id="RatZarr.readBlock-279"><a href="#RatZarr.readBlock-279"><span class="linenos">279</span></a>
</span><span id="RatZarr.readBlock-280"><a href="#RatZarr.readBlock-280"><span class="linenos">280</span></a><span class="sd">        To read the entire column, use startRow=0 and blockLen=rowCount.</span>
</span><span id="RatZarr.readBlock-281"><a href="#RatZarr.readBlock-281"><span class="linenos">281</span></a>
</span><span id="RatZarr.readBlock-282"><a href="#RatZarr.readBlock-282"><span class="linenos">282</span></a><span class="sd">        For best efficiency, use a block length which is a multiple of the</span>
</span><span id="RatZarr.readBlock-283"><a href="#RatZarr.readBlock-283"><span class="linenos">283</span></a><span class="sd">        chunk size (see getRATChunkSize, getColumnChunkSize).</span>
</span><span id="RatZarr.readBlock-284"><a href="#RatZarr.readBlock-284"><span class="linenos">284</span></a>
</span><span id="RatZarr.readBlock-285"><a href="#RatZarr.readBlock-285"><span class="linenos">285</span></a><span class="sd">        If startRow+blockLen is larger than the column length, only</span>
</span><span id="RatZarr.readBlock-286"><a href="#RatZarr.readBlock-286"><span class="linenos">286</span></a><span class="sd">        the available rows are read, and the returned array has this smaller</span>
</span><span id="RatZarr.readBlock-287"><a href="#RatZarr.readBlock-287"><span class="linenos">287</span></a><span class="sd">        size.</span>
</span><span id="RatZarr.readBlock-288"><a href="#RatZarr.readBlock-288"><span class="linenos">288</span></a>
</span><span id="RatZarr.readBlock-289"><a href="#RatZarr.readBlock-289"><span class="linenos">289</span></a><span class="sd">        Parameters</span>
</span><span id="RatZarr.readBlock-290"><a href="#RatZarr.readBlock-290"><span class="linenos">290</span></a><span class="sd">        ----------</span>
</span><span id="RatZarr.readBlock-291"><a href="#RatZarr.readBlock-291"><span class="linenos">291</span></a><span class="sd">          colName : str</span>
</span><span id="RatZarr.readBlock-292"><a href="#RatZarr.readBlock-292"><span class="linenos">292</span></a><span class="sd">            Name of column</span>
</span><span id="RatZarr.readBlock-293"><a href="#RatZarr.readBlock-293"><span class="linenos">293</span></a><span class="sd">          startRow : int</span>
</span><span id="RatZarr.readBlock-294"><a href="#RatZarr.readBlock-294"><span class="linenos">294</span></a><span class="sd">            Row of first element to read (starts at 0)</span>
</span><span id="RatZarr.readBlock-295"><a href="#RatZarr.readBlock-295"><span class="linenos">295</span></a><span class="sd">          blockLen : int</span>
</span><span id="RatZarr.readBlock-296"><a href="#RatZarr.readBlock-296"><span class="linenos">296</span></a><span class="sd">            Number of rows to read</span>
</span><span id="RatZarr.readBlock-297"><a href="#RatZarr.readBlock-297"><span class="linenos">297</span></a>
</span><span id="RatZarr.readBlock-298"><a href="#RatZarr.readBlock-298"><span class="linenos">298</span></a><span class="sd">        Returns</span>
</span><span id="RatZarr.readBlock-299"><a href="#RatZarr.readBlock-299"><span class="linenos">299</span></a><span class="sd">        -------</span>
</span><span id="RatZarr.readBlock-300"><a href="#RatZarr.readBlock-300"><span class="linenos">300</span></a><span class="sd">          block : ndarray</span>
</span><span id="RatZarr.readBlock-301"><a href="#RatZarr.readBlock-301"><span class="linenos">301</span></a><span class="sd">            1-d numpy array of data for block</span>
</span><span id="RatZarr.readBlock-302"><a href="#RatZarr.readBlock-302"><span class="linenos">302</span></a>
</span><span id="RatZarr.readBlock-303"><a href="#RatZarr.readBlock-303"><span class="linenos">303</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RatZarr.readBlock-304"><a href="#RatZarr.readBlock-304"><span class="linenos">304</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">openColumn</span><span class="p">(</span><span class="n">colName</span><span class="p">)</span>
</span><span id="RatZarr.readBlock-305"><a href="#RatZarr.readBlock-305"><span class="linenos">305</span></a>        <span class="n">i1</span> <span class="o">=</span> <span class="n">startRow</span>
</span><span id="RatZarr.readBlock-306"><a href="#RatZarr.readBlock-306"><span class="linenos">306</span></a>        <span class="n">i2</span> <span class="o">=</span> <span class="n">startRow</span> <span class="o">+</span> <span class="n">blockLen</span>
</span><span id="RatZarr.readBlock-307"><a href="#RatZarr.readBlock-307"><span class="linenos">307</span></a>        <span class="n">block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnCache</span><span class="p">[</span><span class="n">colName</span><span class="p">][</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">]</span>
</span><span id="RatZarr.readBlock-308"><a href="#RatZarr.readBlock-308"><span class="linenos">308</span></a>        <span class="k">return</span> <span class="n">block</span>
</span></pre></div>


            <div class="docstring"><p>Read a block from the given column. Return a numpy array of the
block.</p>

<p>To read the entire column, use startRow=0 and blockLen=rowCount.</p>

<p>For best efficiency, use a block length which is a multiple of the
chunk size (see getRATChunkSize, getColumnChunkSize).</p>

<p>If startRow+blockLen is larger than the column length, only
the available rows are read, and the returned array has this smaller
size.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>colName</strong> (str):
Name of column</li>
<li><strong>startRow</strong> (int):
Row of first element to read (starts at 0)</li>
<li><strong>blockLen</strong> (int):
Number of rows to read</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>block</strong> (ndarray):
1-d numpy array of data for block</li>
</ul>
</div>


                            </div>
                            <div id="RatZarr.writeBlock" class="classattr">
                                        <input id="RatZarr.writeBlock-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">writeBlock</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">colName</span>, </span><span class="param"><span class="n">block</span>, </span><span class="param"><span class="n">startRow</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="RatZarr.writeBlock-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RatZarr.writeBlock"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RatZarr.writeBlock-310"><a href="#RatZarr.writeBlock-310"><span class="linenos">310</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">writeBlock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colName</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">startRow</span><span class="p">):</span>
</span><span id="RatZarr.writeBlock-311"><a href="#RatZarr.writeBlock-311"><span class="linenos">311</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RatZarr.writeBlock-312"><a href="#RatZarr.writeBlock-312"><span class="linenos">312</span></a><span class="sd">        Write the given block of data into the named column, beginning at</span>
</span><span id="RatZarr.writeBlock-313"><a href="#RatZarr.writeBlock-313"><span class="linenos">313</span></a><span class="sd">        startRow. For best performance, use a block length which is a</span>
</span><span id="RatZarr.writeBlock-314"><a href="#RatZarr.writeBlock-314"><span class="linenos">314</span></a><span class="sd">        multiple of the chunk size (see setChunkSize, getRATChunkSize,</span>
</span><span id="RatZarr.writeBlock-315"><a href="#RatZarr.writeBlock-315"><span class="linenos">315</span></a><span class="sd">        getColumnChunkSize).</span>
</span><span id="RatZarr.writeBlock-316"><a href="#RatZarr.writeBlock-316"><span class="linenos">316</span></a>
</span><span id="RatZarr.writeBlock-317"><a href="#RatZarr.writeBlock-317"><span class="linenos">317</span></a><span class="sd">        Parameters</span>
</span><span id="RatZarr.writeBlock-318"><a href="#RatZarr.writeBlock-318"><span class="linenos">318</span></a><span class="sd">        ----------</span>
</span><span id="RatZarr.writeBlock-319"><a href="#RatZarr.writeBlock-319"><span class="linenos">319</span></a><span class="sd">          colName : str</span>
</span><span id="RatZarr.writeBlock-320"><a href="#RatZarr.writeBlock-320"><span class="linenos">320</span></a><span class="sd">            Name of column</span>
</span><span id="RatZarr.writeBlock-321"><a href="#RatZarr.writeBlock-321"><span class="linenos">321</span></a><span class="sd">          block : ndarray</span>
</span><span id="RatZarr.writeBlock-322"><a href="#RatZarr.writeBlock-322"><span class="linenos">322</span></a><span class="sd">            1-d numpy array</span>
</span><span id="RatZarr.writeBlock-323"><a href="#RatZarr.writeBlock-323"><span class="linenos">323</span></a><span class="sd">          startRow : int</span>
</span><span id="RatZarr.writeBlock-324"><a href="#RatZarr.writeBlock-324"><span class="linenos">324</span></a><span class="sd">            Row of first element of block (starts at 0)</span>
</span><span id="RatZarr.writeBlock-325"><a href="#RatZarr.writeBlock-325"><span class="linenos">325</span></a>
</span><span id="RatZarr.writeBlock-326"><a href="#RatZarr.writeBlock-326"><span class="linenos">326</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RatZarr.writeBlock-327"><a href="#RatZarr.writeBlock-327"><span class="linenos">327</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">openColumn</span><span class="p">(</span><span class="n">colName</span><span class="p">)</span>
</span><span id="RatZarr.writeBlock-328"><a href="#RatZarr.writeBlock-328"><span class="linenos">328</span></a>
</span><span id="RatZarr.writeBlock-329"><a href="#RatZarr.writeBlock-329"><span class="linenos">329</span></a>        <span class="n">blockLen</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="RatZarr.writeBlock-330"><a href="#RatZarr.writeBlock-330"><span class="linenos">330</span></a>        <span class="c1"># Check for chunk size warning conditions</span>
</span><span id="RatZarr.writeBlock-331"><a href="#RatZarr.writeBlock-331"><span class="linenos">331</span></a>        <span class="n">chunksize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnCache</span><span class="p">[</span><span class="n">colName</span><span class="p">]</span><span class="o">.</span><span class="n">chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="RatZarr.writeBlock-332"><a href="#RatZarr.writeBlock-332"><span class="linenos">332</span></a>        <span class="k">if</span> <span class="n">blockLen</span> <span class="o">&gt;</span> <span class="n">chunksize</span> <span class="ow">and</span> <span class="p">(</span><span class="n">blockLen</span> <span class="o">%</span> <span class="n">chunksize</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="RatZarr.writeBlock-333"><a href="#RatZarr.writeBlock-333"><span class="linenos">333</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Warning: Block len </span><span class="si">{}</span><span class="s2"> not a multiple of &quot;</span> <span class="o">+</span>
</span><span id="RatZarr.writeBlock-334"><a href="#RatZarr.writeBlock-334"><span class="linenos">334</span></a>                   <span class="s2">&quot;chunk size </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">blockLen</span><span class="p">,</span> <span class="n">chunksize</span><span class="p">)</span>
</span><span id="RatZarr.writeBlock-335"><a href="#RatZarr.writeBlock-335"><span class="linenos">335</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">blockChunkMultipleWarningDone</span><span class="p">:</span>
</span><span id="RatZarr.writeBlock-336"><a href="#RatZarr.writeBlock-336"><span class="linenos">336</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</span><span id="RatZarr.writeBlock-337"><a href="#RatZarr.writeBlock-337"><span class="linenos">337</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">blockChunkMultipleWarningDone</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="RatZarr.writeBlock-338"><a href="#RatZarr.writeBlock-338"><span class="linenos">338</span></a>        <span class="k">if</span> <span class="n">blockLen</span> <span class="o">&lt;</span> <span class="n">chunksize</span> <span class="ow">and</span> <span class="p">(</span><span class="n">startRow</span> <span class="o">+</span> <span class="n">blockLen</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="p">:</span>
</span><span id="RatZarr.writeBlock-339"><a href="#RatZarr.writeBlock-339"><span class="linenos">339</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Warning: Block len </span><span class="si">{}</span><span class="s2"> smaller than chunk &quot;</span> <span class="o">+</span>
</span><span id="RatZarr.writeBlock-340"><a href="#RatZarr.writeBlock-340"><span class="linenos">340</span></a>                   <span class="s2">&quot;size </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">blockLen</span><span class="p">,</span> <span class="n">chunksize</span><span class="p">)</span>
</span><span id="RatZarr.writeBlock-341"><a href="#RatZarr.writeBlock-341"><span class="linenos">341</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">smallBlockWarningDone</span><span class="p">:</span>
</span><span id="RatZarr.writeBlock-342"><a href="#RatZarr.writeBlock-342"><span class="linenos">342</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</span><span id="RatZarr.writeBlock-343"><a href="#RatZarr.writeBlock-343"><span class="linenos">343</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">smallBlockWarningDone</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="RatZarr.writeBlock-344"><a href="#RatZarr.writeBlock-344"><span class="linenos">344</span></a>
</span><span id="RatZarr.writeBlock-345"><a href="#RatZarr.writeBlock-345"><span class="linenos">345</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">startRow</span> <span class="o">+</span> <span class="n">blockLen</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="p">:</span>
</span><span id="RatZarr.writeBlock-346"><a href="#RatZarr.writeBlock-346"><span class="linenos">346</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Current rowCount </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="si">}</span><span class="s2"> too small for block of &quot;</span>
</span><span id="RatZarr.writeBlock-347"><a href="#RatZarr.writeBlock-347"><span class="linenos">347</span></a>            <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;length </span><span class="si">{</span><span class="n">blockLen</span><span class="si">}</span><span class="s2"> at startRow </span><span class="si">{</span><span class="n">startRow</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="RatZarr.writeBlock-348"><a href="#RatZarr.writeBlock-348"><span class="linenos">348</span></a>            <span class="k">raise</span> <span class="n">RatZarrError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="RatZarr.writeBlock-349"><a href="#RatZarr.writeBlock-349"><span class="linenos">349</span></a>
</span><span id="RatZarr.writeBlock-350"><a href="#RatZarr.writeBlock-350"><span class="linenos">350</span></a>        <span class="n">i1</span> <span class="o">=</span> <span class="n">startRow</span>
</span><span id="RatZarr.writeBlock-351"><a href="#RatZarr.writeBlock-351"><span class="linenos">351</span></a>        <span class="n">i2</span> <span class="o">=</span> <span class="n">startRow</span> <span class="o">+</span> <span class="n">blockLen</span>
</span><span id="RatZarr.writeBlock-352"><a href="#RatZarr.writeBlock-352"><span class="linenos">352</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">columnCache</span><span class="p">[</span><span class="n">colName</span><span class="p">][</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">]</span> <span class="o">=</span> <span class="n">block</span>
</span></pre></div>


            <div class="docstring"><p>Write the given block of data into the named column, beginning at
startRow. For best performance, use a block length which is a
multiple of the chunk size (see setChunkSize, getRATChunkSize,
getColumnChunkSize).</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>colName</strong> (str):
Name of column</li>
<li><strong>block</strong> (ndarray):
1-d numpy array</li>
<li><strong>startRow</strong> (int):
Row of first element of block (starts at 0)</li>
</ul>
</div>


                            </div>
                            <div id="RatZarr.setChunkSize" class="classattr">
                                        <input id="RatZarr.setChunkSize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">setChunkSize</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">chunksize</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="RatZarr.setChunkSize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RatZarr.setChunkSize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RatZarr.setChunkSize-354"><a href="#RatZarr.setChunkSize-354"><span class="linenos">354</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setChunkSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunksize</span><span class="p">):</span>
</span><span id="RatZarr.setChunkSize-355"><a href="#RatZarr.setChunkSize-355"><span class="linenos">355</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RatZarr.setChunkSize-356"><a href="#RatZarr.setChunkSize-356"><span class="linenos">356</span></a><span class="sd">        Set the Zarr chunk size for all columns created after this call.</span>
</span><span id="RatZarr.setChunkSize-357"><a href="#RatZarr.setChunkSize-357"><span class="linenos">357</span></a><span class="sd">        This defaults to a sensible value, and should only be changed if</span>
</span><span id="RatZarr.setChunkSize-358"><a href="#RatZarr.setChunkSize-358"><span class="linenos">358</span></a><span class="sd">        you know what you are doing. Chunk sizes either too large or too</span>
</span><span id="RatZarr.setChunkSize-359"><a href="#RatZarr.setChunkSize-359"><span class="linenos">359</span></a><span class="sd">        small can have performance implications, so proceed with caution.</span>
</span><span id="RatZarr.setChunkSize-360"><a href="#RatZarr.setChunkSize-360"><span class="linenos">360</span></a>
</span><span id="RatZarr.setChunkSize-361"><a href="#RatZarr.setChunkSize-361"><span class="linenos">361</span></a><span class="sd">        The chunk size is preserved in the disk file, and will apply when</span>
</span><span id="RatZarr.setChunkSize-362"><a href="#RatZarr.setChunkSize-362"><span class="linenos">362</span></a><span class="sd">        next it is opened. Usually best to set this once, so that all</span>
</span><span id="RatZarr.setChunkSize-363"><a href="#RatZarr.setChunkSize-363"><span class="linenos">363</span></a><span class="sd">        columns have the same chunk size.</span>
</span><span id="RatZarr.setChunkSize-364"><a href="#RatZarr.setChunkSize-364"><span class="linenos">364</span></a>
</span><span id="RatZarr.setChunkSize-365"><a href="#RatZarr.setChunkSize-365"><span class="linenos">365</span></a><span class="sd">        When reading and/or writing block-by-block, it is strongly recommended</span>
</span><span id="RatZarr.setChunkSize-366"><a href="#RatZarr.setChunkSize-366"><span class="linenos">366</span></a><span class="sd">        that the block length be a multiple of the chunk size, to avoid</span>
</span><span id="RatZarr.setChunkSize-367"><a href="#RatZarr.setChunkSize-367"><span class="linenos">367</span></a><span class="sd">        significant performance degradation.</span>
</span><span id="RatZarr.setChunkSize-368"><a href="#RatZarr.setChunkSize-368"><span class="linenos">368</span></a>
</span><span id="RatZarr.setChunkSize-369"><a href="#RatZarr.setChunkSize-369"><span class="linenos">369</span></a><span class="sd">        Parameters</span>
</span><span id="RatZarr.setChunkSize-370"><a href="#RatZarr.setChunkSize-370"><span class="linenos">370</span></a><span class="sd">        ----------</span>
</span><span id="RatZarr.setChunkSize-371"><a href="#RatZarr.setChunkSize-371"><span class="linenos">371</span></a><span class="sd">          chunksize : int</span>
</span><span id="RatZarr.setChunkSize-372"><a href="#RatZarr.setChunkSize-372"><span class="linenos">372</span></a><span class="sd">            Number of rows per chunk</span>
</span><span id="RatZarr.setChunkSize-373"><a href="#RatZarr.setChunkSize-373"><span class="linenos">373</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RatZarr.setChunkSize-374"><a href="#RatZarr.setChunkSize-374"><span class="linenos">374</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chunksize</span> <span class="o">=</span> <span class="n">chunksize</span>
</span><span id="RatZarr.setChunkSize-375"><a href="#RatZarr.setChunkSize-375"><span class="linenos">375</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RatZarr.setChunkSize-376"><a href="#RatZarr.setChunkSize-376"><span class="linenos">376</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">grp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">CHUNKSIZE_ATTR</span><span class="p">]</span> <span class="o">=</span> <span class="n">chunksize</span>
</span></pre></div>


            <div class="docstring"><p>Set the Zarr chunk size for all columns created after this call.
This defaults to a sensible value, and should only be changed if
you know what you are doing. Chunk sizes either too large or too
small can have performance implications, so proceed with caution.</p>

<p>The chunk size is preserved in the disk file, and will apply when
next it is opened. Usually best to set this once, so that all
columns have the same chunk size.</p>

<p>When reading and/or writing block-by-block, it is strongly recommended
that the block length be a multiple of the chunk size, to avoid
significant performance degradation.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>chunksize</strong> (int):
Number of rows per chunk</li>
</ul>
</div>


                            </div>
                            <div id="RatZarr.getRATChunkSize" class="classattr">
                                        <input id="RatZarr.getRATChunkSize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">getRATChunkSize</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="RatZarr.getRATChunkSize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RatZarr.getRATChunkSize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RatZarr.getRATChunkSize-378"><a href="#RatZarr.getRATChunkSize-378"><span class="linenos">378</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">getRATChunkSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="RatZarr.getRATChunkSize-379"><a href="#RatZarr.getRATChunkSize-379"><span class="linenos">379</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RatZarr.getRATChunkSize-380"><a href="#RatZarr.getRATChunkSize-380"><span class="linenos">380</span></a><span class="sd">        Return the chunk size for the RAT.</span>
</span><span id="RatZarr.getRATChunkSize-381"><a href="#RatZarr.getRATChunkSize-381"><span class="linenos">381</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RatZarr.getRATChunkSize-382"><a href="#RatZarr.getRATChunkSize-382"><span class="linenos">382</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">grp</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CHUNKSIZE_ATTR</span><span class="p">,</span> <span class="n">DFLT_CHUNKSIZE</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return the chunk size for the RAT.</p>
</div>


                            </div>
                            <div id="RatZarr.getColumnChunkSize" class="classattr">
                                        <input id="RatZarr.getColumnChunkSize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">getColumnChunkSize</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">colName</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="RatZarr.getColumnChunkSize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RatZarr.getColumnChunkSize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RatZarr.getColumnChunkSize-384"><a href="#RatZarr.getColumnChunkSize-384"><span class="linenos">384</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">getColumnChunkSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colName</span><span class="p">):</span>
</span><span id="RatZarr.getColumnChunkSize-385"><a href="#RatZarr.getColumnChunkSize-385"><span class="linenos">385</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RatZarr.getColumnChunkSize-386"><a href="#RatZarr.getColumnChunkSize-386"><span class="linenos">386</span></a><span class="sd">        Get the chunk size for the given column. Normally this is the same as</span>
</span><span id="RatZarr.getColumnChunkSize-387"><a href="#RatZarr.getColumnChunkSize-387"><span class="linenos">387</span></a><span class="sd">        the chunk size for the whole RAT, but if you suspect it is different,</span>
</span><span id="RatZarr.getColumnChunkSize-388"><a href="#RatZarr.getColumnChunkSize-388"><span class="linenos">388</span></a><span class="sd">        use this to check.</span>
</span><span id="RatZarr.getColumnChunkSize-389"><a href="#RatZarr.getColumnChunkSize-389"><span class="linenos">389</span></a>
</span><span id="RatZarr.getColumnChunkSize-390"><a href="#RatZarr.getColumnChunkSize-390"><span class="linenos">390</span></a><span class="sd">        Parameters</span>
</span><span id="RatZarr.getColumnChunkSize-391"><a href="#RatZarr.getColumnChunkSize-391"><span class="linenos">391</span></a><span class="sd">        ----------</span>
</span><span id="RatZarr.getColumnChunkSize-392"><a href="#RatZarr.getColumnChunkSize-392"><span class="linenos">392</span></a><span class="sd">          colName : str</span>
</span><span id="RatZarr.getColumnChunkSize-393"><a href="#RatZarr.getColumnChunkSize-393"><span class="linenos">393</span></a><span class="sd">            Name of column</span>
</span><span id="RatZarr.getColumnChunkSize-394"><a href="#RatZarr.getColumnChunkSize-394"><span class="linenos">394</span></a>
</span><span id="RatZarr.getColumnChunkSize-395"><a href="#RatZarr.getColumnChunkSize-395"><span class="linenos">395</span></a><span class="sd">        Returns</span>
</span><span id="RatZarr.getColumnChunkSize-396"><a href="#RatZarr.getColumnChunkSize-396"><span class="linenos">396</span></a><span class="sd">        -------</span>
</span><span id="RatZarr.getColumnChunkSize-397"><a href="#RatZarr.getColumnChunkSize-397"><span class="linenos">397</span></a><span class="sd">          chunkSize : int</span>
</span><span id="RatZarr.getColumnChunkSize-398"><a href="#RatZarr.getColumnChunkSize-398"><span class="linenos">398</span></a><span class="sd">            The chunk size for the given column (usually set when it was</span>
</span><span id="RatZarr.getColumnChunkSize-399"><a href="#RatZarr.getColumnChunkSize-399"><span class="linenos">399</span></a><span class="sd">            created)</span>
</span><span id="RatZarr.getColumnChunkSize-400"><a href="#RatZarr.getColumnChunkSize-400"><span class="linenos">400</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RatZarr.getColumnChunkSize-401"><a href="#RatZarr.getColumnChunkSize-401"><span class="linenos">401</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">openColumn</span><span class="p">(</span><span class="n">colName</span><span class="p">)</span>
</span><span id="RatZarr.getColumnChunkSize-402"><a href="#RatZarr.getColumnChunkSize-402"><span class="linenos">402</span></a>        <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnCache</span><span class="p">[</span><span class="n">colName</span><span class="p">]</span><span class="o">.</span><span class="n">chunks</span>
</span><span id="RatZarr.getColumnChunkSize-403"><a href="#RatZarr.getColumnChunkSize-403"><span class="linenos">403</span></a>        <span class="k">return</span> <span class="n">chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Get the chunk size for the given column. Normally this is the same as
the chunk size for the whole RAT, but if you suspect it is different,
use this to check.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>colName</strong> (str):
Name of column</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>chunkSize</strong> (int):
The chunk size for the given column (usually set when it was
created)</li>
</ul>
</div>


                            </div>
                </section>
                <section id="RatZarrError">
                            <input id="RatZarrError-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">RatZarrError</span><wbr>(<span class="base">builtins.Exception</span>):

                <label class="view-source-button" for="RatZarrError-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RatZarrError"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RatZarrError-406"><a href="#RatZarrError-406"><span class="linenos">406</span></a><span class="k">class</span><span class="w"> </span><span class="nc">RatZarrError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
</span><span id="RatZarrError-407"><a href="#RatZarrError-407"><span class="linenos">407</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RatZarrError-408"><a href="#RatZarrError-408"><span class="linenos">408</span></a><span class="sd">    Generic exception for RatZarr</span>
</span><span id="RatZarrError-409"><a href="#RatZarrError-409"><span class="linenos">409</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Generic exception for RatZarr</p>
</div>


                </section>
                <section id="colNameByType">
                    <div class="attr variable">
            <span class="name">colNameByType</span>        =
<input id="colNameByType-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="colNameByType-view-value"></label><span class="default_value">{&lt;class &#39;numpy.int32&#39;&gt;: &#39;int32col&#39;, &lt;class &#39;numpy.float32&#39;&gt;: &#39;float32col&#39;, StringDType(): &#39;stringcol&#39;}</span>

        
    </div>
    <a class="headerlink" href="#colNameByType"></a>
    
    

                </section>
                <section id="AllTests">
                            <input id="AllTests-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">AllTests</span><wbr>(<span class="base">unittest.case.TestCase</span>):

                <label class="view-source-button" for="AllTests-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AllTests"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AllTests-424"><a href="#AllTests-424"><span class="linenos">424</span></a><span class="k">class</span><span class="w"> </span><span class="nc">AllTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
</span><span id="AllTests-425"><a href="#AllTests-425"><span class="linenos">425</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AllTests-426"><a href="#AllTests-426"><span class="linenos">426</span></a><span class="sd">    Run all tests</span>
</span><span id="AllTests-427"><a href="#AllTests-427"><span class="linenos">427</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="AllTests-428"><a href="#AllTests-428"><span class="linenos">428</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_simple</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="AllTests-429"><a href="#AllTests-429"><span class="linenos">429</span></a>        <span class="s2">&quot;Test reading/writing/creating a simple RAT&quot;</span>
</span><span id="AllTests-430"><a href="#AllTests-430"><span class="linenos">430</span></a>        <span class="n">fn</span> <span class="o">=</span> <span class="s1">&#39;test1.zarr&#39;</span>
</span><span id="AllTests-431"><a href="#AllTests-431"><span class="linenos">431</span></a>        <span class="n">fullFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeFilename</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="AllTests-432"><a href="#AllTests-432"><span class="linenos">432</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deleteTestFile</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="AllTests-433"><a href="#AllTests-433"><span class="linenos">433</span></a>        <span class="n">rz</span> <span class="o">=</span> <span class="n">RatZarr</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">)</span>
</span><span id="AllTests-434"><a href="#AllTests-434"><span class="linenos">434</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="AllTests-435"><a href="#AllTests-435"><span class="linenos">435</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="AllTests-436"><a href="#AllTests-436"><span class="linenos">436</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">setChunkSize</span><span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="AllTests-437"><a href="#AllTests-437"><span class="linenos">437</span></a>        <span class="k">for</span> <span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">colName</span><span class="p">)</span> <span class="ow">in</span> <span class="n">colNameByType</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="AllTests-438"><a href="#AllTests-438"><span class="linenos">438</span></a>            <span class="n">rz</span><span class="o">.</span><span class="n">createColumn</span><span class="p">(</span><span class="n">colName</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span><span id="AllTests-439"><a href="#AllTests-439"><span class="linenos">439</span></a>            <span class="n">block</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
</span><span id="AllTests-440"><a href="#AllTests-440"><span class="linenos">440</span></a>            <span class="n">rz</span><span class="o">.</span><span class="n">writeBlock</span><span class="p">(</span><span class="n">colName</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="AllTests-441"><a href="#AllTests-441"><span class="linenos">441</span></a>            <span class="n">rz</span><span class="o">.</span><span class="n">writeBlock</span><span class="p">(</span><span class="n">colName</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="AllTests-442"><a href="#AllTests-442"><span class="linenos">442</span></a>
</span><span id="AllTests-443"><a href="#AllTests-443"><span class="linenos">443</span></a>            <span class="n">trueCol</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">block</span><span class="p">,</span> <span class="n">block</span><span class="p">])</span>
</span><span id="AllTests-444"><a href="#AllTests-444"><span class="linenos">444</span></a>            <span class="n">col</span> <span class="o">=</span> <span class="n">rz</span><span class="o">.</span><span class="n">readBlock</span><span class="p">(</span><span class="n">colName</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span><span id="AllTests-445"><a href="#AllTests-445"><span class="linenos">445</span></a>
</span><span id="AllTests-446"><a href="#AllTests-446"><span class="linenos">446</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">col</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="s1">&#39;dtype mis-match&#39;</span><span class="p">)</span>
</span><span id="AllTests-447"><a href="#AllTests-447"><span class="linenos">447</span></a>            <span class="n">numpy</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_array_equal</span><span class="p">(</span>
</span><span id="AllTests-448"><a href="#AllTests-448"><span class="linenos">448</span></a>                <span class="n">col</span><span class="p">,</span> <span class="n">trueCol</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Column data mis-match (dtype=</span><span class="si">{</span><span class="n">block</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
</span><span id="AllTests-449"><a href="#AllTests-449"><span class="linenos">449</span></a>
</span><span id="AllTests-450"><a href="#AllTests-450"><span class="linenos">450</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deleteTestFile</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="AllTests-451"><a href="#AllTests-451"><span class="linenos">451</span></a>
</span><span id="AllTests-452"><a href="#AllTests-452"><span class="linenos">452</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="AllTests-453"><a href="#AllTests-453"><span class="linenos">453</span></a>        <span class="s2">&quot;Test a bunch of exception conditions on constructor flags&quot;</span>
</span><span id="AllTests-454"><a href="#AllTests-454"><span class="linenos">454</span></a>        <span class="n">fn</span> <span class="o">=</span> <span class="s1">&#39;test1.zarr&#39;</span>
</span><span id="AllTests-455"><a href="#AllTests-455"><span class="linenos">455</span></a>        <span class="n">fullFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeFilename</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="AllTests-456"><a href="#AllTests-456"><span class="linenos">456</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deleteTestFile</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="AllTests-457"><a href="#AllTests-457"><span class="linenos">457</span></a>
</span><span id="AllTests-458"><a href="#AllTests-458"><span class="linenos">458</span></a>        <span class="c1"># readOnly with non-existent file</span>
</span><span id="AllTests-459"><a href="#AllTests-459"><span class="linenos">459</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">RatZarrError</span><span class="p">):</span>
</span><span id="AllTests-460"><a href="#AllTests-460"><span class="linenos">460</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="n">RatZarr</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">,</span> <span class="n">readOnly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="AllTests-461"><a href="#AllTests-461"><span class="linenos">461</span></a>        <span class="c1"># create=False with non-existent file</span>
</span><span id="AllTests-462"><a href="#AllTests-462"><span class="linenos">462</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">RatZarrError</span><span class="p">):</span>
</span><span id="AllTests-463"><a href="#AllTests-463"><span class="linenos">463</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="n">RatZarr</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="AllTests-464"><a href="#AllTests-464"><span class="linenos">464</span></a>
</span><span id="AllTests-465"><a href="#AllTests-465"><span class="linenos">465</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deleteTestFile</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="AllTests-466"><a href="#AllTests-466"><span class="linenos">466</span></a>
</span><span id="AllTests-467"><a href="#AllTests-467"><span class="linenos">467</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_resize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="AllTests-468"><a href="#AllTests-468"><span class="linenos">468</span></a>        <span class="s2">&quot;Reset rowCount&quot;</span>
</span><span id="AllTests-469"><a href="#AllTests-469"><span class="linenos">469</span></a>        <span class="n">fn</span> <span class="o">=</span> <span class="s1">&#39;test1.zarr&#39;</span>
</span><span id="AllTests-470"><a href="#AllTests-470"><span class="linenos">470</span></a>        <span class="n">fullFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeFilename</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="AllTests-471"><a href="#AllTests-471"><span class="linenos">471</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deleteTestFile</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="AllTests-472"><a href="#AllTests-472"><span class="linenos">472</span></a>
</span><span id="AllTests-473"><a href="#AllTests-473"><span class="linenos">473</span></a>        <span class="n">rz</span> <span class="o">=</span> <span class="n">RatZarr</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">)</span>
</span><span id="AllTests-474"><a href="#AllTests-474"><span class="linenos">474</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="AllTests-475"><a href="#AllTests-475"><span class="linenos">475</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="AllTests-476"><a href="#AllTests-476"><span class="linenos">476</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span><span id="AllTests-477"><a href="#AllTests-477"><span class="linenos">477</span></a>        <span class="n">colName</span> <span class="o">=</span> <span class="s1">&#39;col1&#39;</span>
</span><span id="AllTests-478"><a href="#AllTests-478"><span class="linenos">478</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">createColumn</span><span class="p">(</span><span class="n">colName</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="AllTests-479"><a href="#AllTests-479"><span class="linenos">479</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">writeBlock</span><span class="p">(</span><span class="n">colName</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="AllTests-480"><a href="#AllTests-480"><span class="linenos">480</span></a>
</span><span id="AllTests-481"><a href="#AllTests-481"><span class="linenos">481</span></a>        <span class="c1"># Resize to smaller</span>
</span><span id="AllTests-482"><a href="#AllTests-482"><span class="linenos">482</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="AllTests-483"><a href="#AllTests-483"><span class="linenos">483</span></a>        <span class="n">col</span> <span class="o">=</span> <span class="n">rz</span><span class="o">.</span><span class="n">readBlock</span><span class="p">(</span><span class="n">colName</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span><span id="AllTests-484"><a href="#AllTests-484"><span class="linenos">484</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
</span><span id="AllTests-485"><a href="#AllTests-485"><span class="linenos">485</span></a>            <span class="n">col</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="AllTests-486"><a href="#AllTests-486"><span class="linenos">486</span></a>            <span class="s1">&#39;Truncated rowCount mis-match&#39;</span><span class="p">)</span>
</span><span id="AllTests-487"><a href="#AllTests-487"><span class="linenos">487</span></a>
</span><span id="AllTests-488"><a href="#AllTests-488"><span class="linenos">488</span></a>        <span class="c1"># Resize bigger</span>
</span><span id="AllTests-489"><a href="#AllTests-489"><span class="linenos">489</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="AllTests-490"><a href="#AllTests-490"><span class="linenos">490</span></a>        <span class="n">col</span> <span class="o">=</span> <span class="n">rz</span><span class="o">.</span><span class="n">readBlock</span><span class="p">(</span><span class="n">colName</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span><span id="AllTests-491"><a href="#AllTests-491"><span class="linenos">491</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="s1">&#39;Increased rowCount mis-match&#39;</span><span class="p">)</span>
</span><span id="AllTests-492"><a href="#AllTests-492"><span class="linenos">492</span></a>
</span><span id="AllTests-493"><a href="#AllTests-493"><span class="linenos">493</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deleteTestFile</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="AllTests-494"><a href="#AllTests-494"><span class="linenos">494</span></a>
</span><span id="AllTests-495"><a href="#AllTests-495"><span class="linenos">495</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_colnames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="AllTests-496"><a href="#AllTests-496"><span class="linenos">496</span></a>        <span class="s2">&quot;Handling column names&quot;</span>
</span><span id="AllTests-497"><a href="#AllTests-497"><span class="linenos">497</span></a>        <span class="n">fn</span> <span class="o">=</span> <span class="s1">&#39;test1.zarr&#39;</span>
</span><span id="AllTests-498"><a href="#AllTests-498"><span class="linenos">498</span></a>        <span class="n">fullFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeFilename</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="AllTests-499"><a href="#AllTests-499"><span class="linenos">499</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deleteTestFile</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="AllTests-500"><a href="#AllTests-500"><span class="linenos">500</span></a>
</span><span id="AllTests-501"><a href="#AllTests-501"><span class="linenos">501</span></a>        <span class="n">rz</span> <span class="o">=</span> <span class="n">RatZarr</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">)</span>
</span><span id="AllTests-502"><a href="#AllTests-502"><span class="linenos">502</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="AllTests-503"><a href="#AllTests-503"><span class="linenos">503</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="AllTests-504"><a href="#AllTests-504"><span class="linenos">504</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span><span id="AllTests-505"><a href="#AllTests-505"><span class="linenos">505</span></a>        <span class="n">col1</span> <span class="o">=</span> <span class="s1">&#39;col1&#39;</span>
</span><span id="AllTests-506"><a href="#AllTests-506"><span class="linenos">506</span></a>        <span class="n">col2</span> <span class="o">=</span> <span class="s1">&#39;col2&#39;</span>
</span><span id="AllTests-507"><a href="#AllTests-507"><span class="linenos">507</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">createColumn</span><span class="p">(</span><span class="n">col1</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="AllTests-508"><a href="#AllTests-508"><span class="linenos">508</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">createColumn</span><span class="p">(</span><span class="n">col2</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="AllTests-509"><a href="#AllTests-509"><span class="linenos">509</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">rz</span><span class="o">.</span><span class="n">colExists</span><span class="p">(</span><span class="n">col1</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Column &#39;</span><span class="si">{</span><span class="n">col1</span><span class="si">}</span><span class="s2">&#39; does not exist&quot;</span><span class="p">)</span>
</span><span id="AllTests-510"><a href="#AllTests-510"><span class="linenos">510</span></a>        <span class="n">colNameList</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">rz</span><span class="o">.</span><span class="n">getColumnNames</span><span class="p">())</span>
</span><span id="AllTests-511"><a href="#AllTests-511"><span class="linenos">511</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertListEqual</span><span class="p">(</span>
</span><span id="AllTests-512"><a href="#AllTests-512"><span class="linenos">512</span></a>            <span class="n">colNameList</span><span class="p">,</span> <span class="p">[</span><span class="n">col1</span><span class="p">,</span> <span class="n">col2</span><span class="p">],</span>
</span><span id="AllTests-513"><a href="#AllTests-513"><span class="linenos">513</span></a>            <span class="s1">&#39;Incorrect list of columns&#39;</span><span class="p">)</span>
</span><span id="AllTests-514"><a href="#AllTests-514"><span class="linenos">514</span></a>
</span><span id="AllTests-515"><a href="#AllTests-515"><span class="linenos">515</span></a>        <span class="c1"># Delete a column</span>
</span><span id="AllTests-516"><a href="#AllTests-516"><span class="linenos">516</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">deleteColumn</span><span class="p">(</span><span class="n">col1</span><span class="p">)</span>
</span><span id="AllTests-517"><a href="#AllTests-517"><span class="linenos">517</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">rz</span><span class="o">.</span><span class="n">colExists</span><span class="p">(</span><span class="n">col1</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Column &#39;</span><span class="si">{</span><span class="n">col1</span><span class="si">}</span><span class="s2">&#39; not deleted&quot;</span><span class="p">)</span>
</span><span id="AllTests-518"><a href="#AllTests-518"><span class="linenos">518</span></a>
</span><span id="AllTests-519"><a href="#AllTests-519"><span class="linenos">519</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deleteTestFile</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="AllTests-520"><a href="#AllTests-520"><span class="linenos">520</span></a>
</span><span id="AllTests-521"><a href="#AllTests-521"><span class="linenos">521</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_chunksize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="AllTests-522"><a href="#AllTests-522"><span class="linenos">522</span></a>        <span class="s2">&quot;Chunk size manipulation&quot;</span>
</span><span id="AllTests-523"><a href="#AllTests-523"><span class="linenos">523</span></a>        <span class="n">fn</span> <span class="o">=</span> <span class="s1">&#39;test1.zarr&#39;</span>
</span><span id="AllTests-524"><a href="#AllTests-524"><span class="linenos">524</span></a>        <span class="n">fullFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeFilename</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="AllTests-525"><a href="#AllTests-525"><span class="linenos">525</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deleteTestFile</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="AllTests-526"><a href="#AllTests-526"><span class="linenos">526</span></a>
</span><span id="AllTests-527"><a href="#AllTests-527"><span class="linenos">527</span></a>        <span class="n">rz</span> <span class="o">=</span> <span class="n">RatZarr</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">)</span>
</span><span id="AllTests-528"><a href="#AllTests-528"><span class="linenos">528</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span>
</span><span id="AllTests-529"><a href="#AllTests-529"><span class="linenos">529</span></a>        <span class="n">ratChunk</span> <span class="o">=</span> <span class="n">rz</span><span class="o">.</span><span class="n">getRATChunkSize</span><span class="p">()</span>
</span><span id="AllTests-530"><a href="#AllTests-530"><span class="linenos">530</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ratChunk</span><span class="p">,</span> <span class="n">DFLT_CHUNKSIZE</span><span class="p">,</span>
</span><span id="AllTests-531"><a href="#AllTests-531"><span class="linenos">531</span></a>                         <span class="sa">f</span><span class="s1">&#39;Unexpected chunk size </span><span class="si">{</span><span class="n">ratChunk</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="AllTests-532"><a href="#AllTests-532"><span class="linenos">532</span></a>        <span class="n">newChunk</span> <span class="o">=</span> <span class="mi">100000</span>
</span><span id="AllTests-533"><a href="#AllTests-533"><span class="linenos">533</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">setChunkSize</span><span class="p">(</span><span class="n">newChunk</span><span class="p">)</span>
</span><span id="AllTests-534"><a href="#AllTests-534"><span class="linenos">534</span></a>        <span class="n">ratChunk</span> <span class="o">=</span> <span class="n">rz</span><span class="o">.</span><span class="n">getRATChunkSize</span><span class="p">()</span>
</span><span id="AllTests-535"><a href="#AllTests-535"><span class="linenos">535</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ratChunk</span><span class="p">,</span> <span class="n">newChunk</span><span class="p">,</span>
</span><span id="AllTests-536"><a href="#AllTests-536"><span class="linenos">536</span></a>                         <span class="sa">f</span><span class="s1">&#39;Chunk size not changed: </span><span class="si">{</span><span class="n">ratChunk</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="AllTests-537"><a href="#AllTests-537"><span class="linenos">537</span></a>
</span><span id="AllTests-538"><a href="#AllTests-538"><span class="linenos">538</span></a>        <span class="n">colName</span> <span class="o">=</span> <span class="s1">&#39;col1&#39;</span>
</span><span id="AllTests-539"><a href="#AllTests-539"><span class="linenos">539</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">createColumn</span><span class="p">(</span><span class="n">colName</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span><span id="AllTests-540"><a href="#AllTests-540"><span class="linenos">540</span></a>        <span class="n">colChunk</span> <span class="o">=</span> <span class="n">rz</span><span class="o">.</span><span class="n">getColumnChunkSize</span><span class="p">(</span><span class="n">colName</span><span class="p">)</span>
</span><span id="AllTests-541"><a href="#AllTests-541"><span class="linenos">541</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">colChunk</span><span class="p">,</span> <span class="n">newChunk</span><span class="p">,</span>
</span><span id="AllTests-542"><a href="#AllTests-542"><span class="linenos">542</span></a>                         <span class="sa">f</span><span class="s1">&#39;Unexpected column chunk </span><span class="si">{</span><span class="n">colChunk</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="AllTests-543"><a href="#AllTests-543"><span class="linenos">543</span></a>
</span><span id="AllTests-544"><a href="#AllTests-544"><span class="linenos">544</span></a>        <span class="n">rz2</span> <span class="o">=</span> <span class="n">RatZarr</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">)</span>
</span><span id="AllTests-545"><a href="#AllTests-545"><span class="linenos">545</span></a>        <span class="n">ratChunk</span> <span class="o">=</span> <span class="n">rz2</span><span class="o">.</span><span class="n">getRATChunkSize</span><span class="p">()</span>
</span><span id="AllTests-546"><a href="#AllTests-546"><span class="linenos">546</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ratChunk</span><span class="p">,</span> <span class="n">newChunk</span><span class="p">,</span>
</span><span id="AllTests-547"><a href="#AllTests-547"><span class="linenos">547</span></a>                         <span class="s1">&#39;Chunk size not preserved on disk&#39;</span><span class="p">)</span>
</span><span id="AllTests-548"><a href="#AllTests-548"><span class="linenos">548</span></a>
</span><span id="AllTests-549"><a href="#AllTests-549"><span class="linenos">549</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deleteTestFile</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="AllTests-550"><a href="#AllTests-550"><span class="linenos">550</span></a>
</span><span id="AllTests-551"><a href="#AllTests-551"><span class="linenos">551</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">makeFilename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="AllTests-552"><a href="#AllTests-552"><span class="linenos">552</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AllTests-553"><a href="#AllTests-553"><span class="linenos">553</span></a><span class="sd">        Make full filename string</span>
</span><span id="AllTests-554"><a href="#AllTests-554"><span class="linenos">554</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AllTests-555"><a href="#AllTests-555"><span class="linenos">555</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">s3bucket</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;S3BUCKET&#39;</span><span class="p">)</span>
</span><span id="AllTests-556"><a href="#AllTests-556"><span class="linenos">556</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">s3bucket</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">boto3</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AllTests-557"><a href="#AllTests-557"><span class="linenos">557</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;S3BUCKET given, boto3 unavailable&quot;</span><span class="p">)</span>
</span><span id="AllTests-558"><a href="#AllTests-558"><span class="linenos">558</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">usingS3</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s3bucket</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">boto3</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="AllTests-559"><a href="#AllTests-559"><span class="linenos">559</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">usingS3</span><span class="p">:</span>
</span><span id="AllTests-560"><a href="#AllTests-560"><span class="linenos">560</span></a>            <span class="n">fullFilename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;s3://</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">s3bucket</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AllTests-561"><a href="#AllTests-561"><span class="linenos">561</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AllTests-562"><a href="#AllTests-562"><span class="linenos">562</span></a>            <span class="n">fullFilename</span> <span class="o">=</span> <span class="n">filename</span>
</span><span id="AllTests-563"><a href="#AllTests-563"><span class="linenos">563</span></a>        <span class="k">return</span> <span class="n">fullFilename</span>
</span><span id="AllTests-564"><a href="#AllTests-564"><span class="linenos">564</span></a>
</span><span id="AllTests-565"><a href="#AllTests-565"><span class="linenos">565</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">deleteTestFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="AllTests-566"><a href="#AllTests-566"><span class="linenos">566</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AllTests-567"><a href="#AllTests-567"><span class="linenos">567</span></a><span class="sd">        Delete the given test file, if it exists</span>
</span><span id="AllTests-568"><a href="#AllTests-568"><span class="linenos">568</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AllTests-569"><a href="#AllTests-569"><span class="linenos">569</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">usingS3</span><span class="p">:</span>
</span><span id="AllTests-570"><a href="#AllTests-570"><span class="linenos">570</span></a>            <span class="n">s3client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span>
</span><span id="AllTests-571"><a href="#AllTests-571"><span class="linenos">571</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">s3client</span><span class="o">.</span><span class="n">list_objects</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">s3bucket</span><span class="p">,</span>
</span><span id="AllTests-572"><a href="#AllTests-572"><span class="linenos">572</span></a>                                             <span class="n">Prefix</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
</span><span id="AllTests-573"><a href="#AllTests-573"><span class="linenos">573</span></a>            <span class="k">if</span> <span class="s1">&#39;Contents&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
</span><span id="AllTests-574"><a href="#AllTests-574"><span class="linenos">574</span></a>                <span class="n">objectKeyList</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;Key&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;Contents&#39;</span><span class="p">]]</span>
</span><span id="AllTests-575"><a href="#AllTests-575"><span class="linenos">575</span></a>                <span class="n">objSpec</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Objects&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;Key&#39;</span><span class="p">:</span> <span class="n">k</span><span class="p">}</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">objectKeyList</span><span class="p">]}</span>
</span><span id="AllTests-576"><a href="#AllTests-576"><span class="linenos">576</span></a>                <span class="n">s3client</span><span class="o">.</span><span class="n">delete_objects</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">s3bucket</span><span class="p">,</span>
</span><span id="AllTests-577"><a href="#AllTests-577"><span class="linenos">577</span></a>                                        <span class="n">Delete</span><span class="o">=</span><span class="n">objSpec</span><span class="p">)</span>
</span><span id="AllTests-578"><a href="#AllTests-578"><span class="linenos">578</span></a>
</span><span id="AllTests-579"><a href="#AllTests-579"><span class="linenos">579</span></a>            <span class="c1"># Wait until it is actually gone</span>
</span><span id="AllTests-580"><a href="#AllTests-580"><span class="linenos">580</span></a>            <span class="k">while</span> <span class="s1">&#39;Contents&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
</span><span id="AllTests-581"><a href="#AllTests-581"><span class="linenos">581</span></a>                <span class="n">response</span> <span class="o">=</span> <span class="n">s3client</span><span class="o">.</span><span class="n">list_objects</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">s3bucket</span><span class="p">,</span>
</span><span id="AllTests-582"><a href="#AllTests-582"><span class="linenos">582</span></a>                                                 <span class="n">Prefix</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
</span><span id="AllTests-583"><a href="#AllTests-583"><span class="linenos">583</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AllTests-584"><a href="#AllTests-584"><span class="linenos">584</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
</span><span id="AllTests-585"><a href="#AllTests-585"><span class="linenos">585</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Run all tests</p>
</div>


                            <div id="AllTests.test_simple" class="classattr">
                                        <input id="AllTests.test_simple-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">test_simple</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="AllTests.test_simple-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AllTests.test_simple"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AllTests.test_simple-428"><a href="#AllTests.test_simple-428"><span class="linenos">428</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_simple</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="AllTests.test_simple-429"><a href="#AllTests.test_simple-429"><span class="linenos">429</span></a>        <span class="s2">&quot;Test reading/writing/creating a simple RAT&quot;</span>
</span><span id="AllTests.test_simple-430"><a href="#AllTests.test_simple-430"><span class="linenos">430</span></a>        <span class="n">fn</span> <span class="o">=</span> <span class="s1">&#39;test1.zarr&#39;</span>
</span><span id="AllTests.test_simple-431"><a href="#AllTests.test_simple-431"><span class="linenos">431</span></a>        <span class="n">fullFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeFilename</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="AllTests.test_simple-432"><a href="#AllTests.test_simple-432"><span class="linenos">432</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deleteTestFile</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="AllTests.test_simple-433"><a href="#AllTests.test_simple-433"><span class="linenos">433</span></a>        <span class="n">rz</span> <span class="o">=</span> <span class="n">RatZarr</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">)</span>
</span><span id="AllTests.test_simple-434"><a href="#AllTests.test_simple-434"><span class="linenos">434</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="AllTests.test_simple-435"><a href="#AllTests.test_simple-435"><span class="linenos">435</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="AllTests.test_simple-436"><a href="#AllTests.test_simple-436"><span class="linenos">436</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">setChunkSize</span><span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="AllTests.test_simple-437"><a href="#AllTests.test_simple-437"><span class="linenos">437</span></a>        <span class="k">for</span> <span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">colName</span><span class="p">)</span> <span class="ow">in</span> <span class="n">colNameByType</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="AllTests.test_simple-438"><a href="#AllTests.test_simple-438"><span class="linenos">438</span></a>            <span class="n">rz</span><span class="o">.</span><span class="n">createColumn</span><span class="p">(</span><span class="n">colName</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span><span id="AllTests.test_simple-439"><a href="#AllTests.test_simple-439"><span class="linenos">439</span></a>            <span class="n">block</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
</span><span id="AllTests.test_simple-440"><a href="#AllTests.test_simple-440"><span class="linenos">440</span></a>            <span class="n">rz</span><span class="o">.</span><span class="n">writeBlock</span><span class="p">(</span><span class="n">colName</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="AllTests.test_simple-441"><a href="#AllTests.test_simple-441"><span class="linenos">441</span></a>            <span class="n">rz</span><span class="o">.</span><span class="n">writeBlock</span><span class="p">(</span><span class="n">colName</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="AllTests.test_simple-442"><a href="#AllTests.test_simple-442"><span class="linenos">442</span></a>
</span><span id="AllTests.test_simple-443"><a href="#AllTests.test_simple-443"><span class="linenos">443</span></a>            <span class="n">trueCol</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">block</span><span class="p">,</span> <span class="n">block</span><span class="p">])</span>
</span><span id="AllTests.test_simple-444"><a href="#AllTests.test_simple-444"><span class="linenos">444</span></a>            <span class="n">col</span> <span class="o">=</span> <span class="n">rz</span><span class="o">.</span><span class="n">readBlock</span><span class="p">(</span><span class="n">colName</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span><span id="AllTests.test_simple-445"><a href="#AllTests.test_simple-445"><span class="linenos">445</span></a>
</span><span id="AllTests.test_simple-446"><a href="#AllTests.test_simple-446"><span class="linenos">446</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">col</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="s1">&#39;dtype mis-match&#39;</span><span class="p">)</span>
</span><span id="AllTests.test_simple-447"><a href="#AllTests.test_simple-447"><span class="linenos">447</span></a>            <span class="n">numpy</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_array_equal</span><span class="p">(</span>
</span><span id="AllTests.test_simple-448"><a href="#AllTests.test_simple-448"><span class="linenos">448</span></a>                <span class="n">col</span><span class="p">,</span> <span class="n">trueCol</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Column data mis-match (dtype=</span><span class="si">{</span><span class="n">block</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
</span><span id="AllTests.test_simple-449"><a href="#AllTests.test_simple-449"><span class="linenos">449</span></a>
</span><span id="AllTests.test_simple-450"><a href="#AllTests.test_simple-450"><span class="linenos">450</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deleteTestFile</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Test reading/writing/creating a simple RAT</p>
</div>


                            </div>
                            <div id="AllTests.test_flags" class="classattr">
                                        <input id="AllTests.test_flags-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">test_flags</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="AllTests.test_flags-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AllTests.test_flags"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AllTests.test_flags-452"><a href="#AllTests.test_flags-452"><span class="linenos">452</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="AllTests.test_flags-453"><a href="#AllTests.test_flags-453"><span class="linenos">453</span></a>        <span class="s2">&quot;Test a bunch of exception conditions on constructor flags&quot;</span>
</span><span id="AllTests.test_flags-454"><a href="#AllTests.test_flags-454"><span class="linenos">454</span></a>        <span class="n">fn</span> <span class="o">=</span> <span class="s1">&#39;test1.zarr&#39;</span>
</span><span id="AllTests.test_flags-455"><a href="#AllTests.test_flags-455"><span class="linenos">455</span></a>        <span class="n">fullFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeFilename</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="AllTests.test_flags-456"><a href="#AllTests.test_flags-456"><span class="linenos">456</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deleteTestFile</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="AllTests.test_flags-457"><a href="#AllTests.test_flags-457"><span class="linenos">457</span></a>
</span><span id="AllTests.test_flags-458"><a href="#AllTests.test_flags-458"><span class="linenos">458</span></a>        <span class="c1"># readOnly with non-existent file</span>
</span><span id="AllTests.test_flags-459"><a href="#AllTests.test_flags-459"><span class="linenos">459</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">RatZarrError</span><span class="p">):</span>
</span><span id="AllTests.test_flags-460"><a href="#AllTests.test_flags-460"><span class="linenos">460</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="n">RatZarr</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">,</span> <span class="n">readOnly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="AllTests.test_flags-461"><a href="#AllTests.test_flags-461"><span class="linenos">461</span></a>        <span class="c1"># create=False with non-existent file</span>
</span><span id="AllTests.test_flags-462"><a href="#AllTests.test_flags-462"><span class="linenos">462</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">RatZarrError</span><span class="p">):</span>
</span><span id="AllTests.test_flags-463"><a href="#AllTests.test_flags-463"><span class="linenos">463</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="n">RatZarr</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="AllTests.test_flags-464"><a href="#AllTests.test_flags-464"><span class="linenos">464</span></a>
</span><span id="AllTests.test_flags-465"><a href="#AllTests.test_flags-465"><span class="linenos">465</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deleteTestFile</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Test a bunch of exception conditions on constructor flags</p>
</div>


                            </div>
                            <div id="AllTests.test_resize" class="classattr">
                                        <input id="AllTests.test_resize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">test_resize</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="AllTests.test_resize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AllTests.test_resize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AllTests.test_resize-467"><a href="#AllTests.test_resize-467"><span class="linenos">467</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_resize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="AllTests.test_resize-468"><a href="#AllTests.test_resize-468"><span class="linenos">468</span></a>        <span class="s2">&quot;Reset rowCount&quot;</span>
</span><span id="AllTests.test_resize-469"><a href="#AllTests.test_resize-469"><span class="linenos">469</span></a>        <span class="n">fn</span> <span class="o">=</span> <span class="s1">&#39;test1.zarr&#39;</span>
</span><span id="AllTests.test_resize-470"><a href="#AllTests.test_resize-470"><span class="linenos">470</span></a>        <span class="n">fullFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeFilename</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="AllTests.test_resize-471"><a href="#AllTests.test_resize-471"><span class="linenos">471</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deleteTestFile</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="AllTests.test_resize-472"><a href="#AllTests.test_resize-472"><span class="linenos">472</span></a>
</span><span id="AllTests.test_resize-473"><a href="#AllTests.test_resize-473"><span class="linenos">473</span></a>        <span class="n">rz</span> <span class="o">=</span> <span class="n">RatZarr</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">)</span>
</span><span id="AllTests.test_resize-474"><a href="#AllTests.test_resize-474"><span class="linenos">474</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="AllTests.test_resize-475"><a href="#AllTests.test_resize-475"><span class="linenos">475</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="AllTests.test_resize-476"><a href="#AllTests.test_resize-476"><span class="linenos">476</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span><span id="AllTests.test_resize-477"><a href="#AllTests.test_resize-477"><span class="linenos">477</span></a>        <span class="n">colName</span> <span class="o">=</span> <span class="s1">&#39;col1&#39;</span>
</span><span id="AllTests.test_resize-478"><a href="#AllTests.test_resize-478"><span class="linenos">478</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">createColumn</span><span class="p">(</span><span class="n">colName</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="AllTests.test_resize-479"><a href="#AllTests.test_resize-479"><span class="linenos">479</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">writeBlock</span><span class="p">(</span><span class="n">colName</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="AllTests.test_resize-480"><a href="#AllTests.test_resize-480"><span class="linenos">480</span></a>
</span><span id="AllTests.test_resize-481"><a href="#AllTests.test_resize-481"><span class="linenos">481</span></a>        <span class="c1"># Resize to smaller</span>
</span><span id="AllTests.test_resize-482"><a href="#AllTests.test_resize-482"><span class="linenos">482</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="AllTests.test_resize-483"><a href="#AllTests.test_resize-483"><span class="linenos">483</span></a>        <span class="n">col</span> <span class="o">=</span> <span class="n">rz</span><span class="o">.</span><span class="n">readBlock</span><span class="p">(</span><span class="n">colName</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span><span id="AllTests.test_resize-484"><a href="#AllTests.test_resize-484"><span class="linenos">484</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
</span><span id="AllTests.test_resize-485"><a href="#AllTests.test_resize-485"><span class="linenos">485</span></a>            <span class="n">col</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="AllTests.test_resize-486"><a href="#AllTests.test_resize-486"><span class="linenos">486</span></a>            <span class="s1">&#39;Truncated rowCount mis-match&#39;</span><span class="p">)</span>
</span><span id="AllTests.test_resize-487"><a href="#AllTests.test_resize-487"><span class="linenos">487</span></a>
</span><span id="AllTests.test_resize-488"><a href="#AllTests.test_resize-488"><span class="linenos">488</span></a>        <span class="c1"># Resize bigger</span>
</span><span id="AllTests.test_resize-489"><a href="#AllTests.test_resize-489"><span class="linenos">489</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="AllTests.test_resize-490"><a href="#AllTests.test_resize-490"><span class="linenos">490</span></a>        <span class="n">col</span> <span class="o">=</span> <span class="n">rz</span><span class="o">.</span><span class="n">readBlock</span><span class="p">(</span><span class="n">colName</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span><span id="AllTests.test_resize-491"><a href="#AllTests.test_resize-491"><span class="linenos">491</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="s1">&#39;Increased rowCount mis-match&#39;</span><span class="p">)</span>
</span><span id="AllTests.test_resize-492"><a href="#AllTests.test_resize-492"><span class="linenos">492</span></a>
</span><span id="AllTests.test_resize-493"><a href="#AllTests.test_resize-493"><span class="linenos">493</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deleteTestFile</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Reset rowCount</p>
</div>


                            </div>
                            <div id="AllTests.test_colnames" class="classattr">
                                        <input id="AllTests.test_colnames-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">test_colnames</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="AllTests.test_colnames-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AllTests.test_colnames"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AllTests.test_colnames-495"><a href="#AllTests.test_colnames-495"><span class="linenos">495</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_colnames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="AllTests.test_colnames-496"><a href="#AllTests.test_colnames-496"><span class="linenos">496</span></a>        <span class="s2">&quot;Handling column names&quot;</span>
</span><span id="AllTests.test_colnames-497"><a href="#AllTests.test_colnames-497"><span class="linenos">497</span></a>        <span class="n">fn</span> <span class="o">=</span> <span class="s1">&#39;test1.zarr&#39;</span>
</span><span id="AllTests.test_colnames-498"><a href="#AllTests.test_colnames-498"><span class="linenos">498</span></a>        <span class="n">fullFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeFilename</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="AllTests.test_colnames-499"><a href="#AllTests.test_colnames-499"><span class="linenos">499</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deleteTestFile</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="AllTests.test_colnames-500"><a href="#AllTests.test_colnames-500"><span class="linenos">500</span></a>
</span><span id="AllTests.test_colnames-501"><a href="#AllTests.test_colnames-501"><span class="linenos">501</span></a>        <span class="n">rz</span> <span class="o">=</span> <span class="n">RatZarr</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">)</span>
</span><span id="AllTests.test_colnames-502"><a href="#AllTests.test_colnames-502"><span class="linenos">502</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="AllTests.test_colnames-503"><a href="#AllTests.test_colnames-503"><span class="linenos">503</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="AllTests.test_colnames-504"><a href="#AllTests.test_colnames-504"><span class="linenos">504</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span><span id="AllTests.test_colnames-505"><a href="#AllTests.test_colnames-505"><span class="linenos">505</span></a>        <span class="n">col1</span> <span class="o">=</span> <span class="s1">&#39;col1&#39;</span>
</span><span id="AllTests.test_colnames-506"><a href="#AllTests.test_colnames-506"><span class="linenos">506</span></a>        <span class="n">col2</span> <span class="o">=</span> <span class="s1">&#39;col2&#39;</span>
</span><span id="AllTests.test_colnames-507"><a href="#AllTests.test_colnames-507"><span class="linenos">507</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">createColumn</span><span class="p">(</span><span class="n">col1</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="AllTests.test_colnames-508"><a href="#AllTests.test_colnames-508"><span class="linenos">508</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">createColumn</span><span class="p">(</span><span class="n">col2</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="AllTests.test_colnames-509"><a href="#AllTests.test_colnames-509"><span class="linenos">509</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">rz</span><span class="o">.</span><span class="n">colExists</span><span class="p">(</span><span class="n">col1</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Column &#39;</span><span class="si">{</span><span class="n">col1</span><span class="si">}</span><span class="s2">&#39; does not exist&quot;</span><span class="p">)</span>
</span><span id="AllTests.test_colnames-510"><a href="#AllTests.test_colnames-510"><span class="linenos">510</span></a>        <span class="n">colNameList</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">rz</span><span class="o">.</span><span class="n">getColumnNames</span><span class="p">())</span>
</span><span id="AllTests.test_colnames-511"><a href="#AllTests.test_colnames-511"><span class="linenos">511</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertListEqual</span><span class="p">(</span>
</span><span id="AllTests.test_colnames-512"><a href="#AllTests.test_colnames-512"><span class="linenos">512</span></a>            <span class="n">colNameList</span><span class="p">,</span> <span class="p">[</span><span class="n">col1</span><span class="p">,</span> <span class="n">col2</span><span class="p">],</span>
</span><span id="AllTests.test_colnames-513"><a href="#AllTests.test_colnames-513"><span class="linenos">513</span></a>            <span class="s1">&#39;Incorrect list of columns&#39;</span><span class="p">)</span>
</span><span id="AllTests.test_colnames-514"><a href="#AllTests.test_colnames-514"><span class="linenos">514</span></a>
</span><span id="AllTests.test_colnames-515"><a href="#AllTests.test_colnames-515"><span class="linenos">515</span></a>        <span class="c1"># Delete a column</span>
</span><span id="AllTests.test_colnames-516"><a href="#AllTests.test_colnames-516"><span class="linenos">516</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">deleteColumn</span><span class="p">(</span><span class="n">col1</span><span class="p">)</span>
</span><span id="AllTests.test_colnames-517"><a href="#AllTests.test_colnames-517"><span class="linenos">517</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">rz</span><span class="o">.</span><span class="n">colExists</span><span class="p">(</span><span class="n">col1</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Column &#39;</span><span class="si">{</span><span class="n">col1</span><span class="si">}</span><span class="s2">&#39; not deleted&quot;</span><span class="p">)</span>
</span><span id="AllTests.test_colnames-518"><a href="#AllTests.test_colnames-518"><span class="linenos">518</span></a>
</span><span id="AllTests.test_colnames-519"><a href="#AllTests.test_colnames-519"><span class="linenos">519</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deleteTestFile</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Handling column names</p>
</div>


                            </div>
                            <div id="AllTests.test_chunksize" class="classattr">
                                        <input id="AllTests.test_chunksize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">test_chunksize</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="AllTests.test_chunksize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AllTests.test_chunksize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AllTests.test_chunksize-521"><a href="#AllTests.test_chunksize-521"><span class="linenos">521</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_chunksize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="AllTests.test_chunksize-522"><a href="#AllTests.test_chunksize-522"><span class="linenos">522</span></a>        <span class="s2">&quot;Chunk size manipulation&quot;</span>
</span><span id="AllTests.test_chunksize-523"><a href="#AllTests.test_chunksize-523"><span class="linenos">523</span></a>        <span class="n">fn</span> <span class="o">=</span> <span class="s1">&#39;test1.zarr&#39;</span>
</span><span id="AllTests.test_chunksize-524"><a href="#AllTests.test_chunksize-524"><span class="linenos">524</span></a>        <span class="n">fullFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeFilename</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="AllTests.test_chunksize-525"><a href="#AllTests.test_chunksize-525"><span class="linenos">525</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deleteTestFile</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="AllTests.test_chunksize-526"><a href="#AllTests.test_chunksize-526"><span class="linenos">526</span></a>
</span><span id="AllTests.test_chunksize-527"><a href="#AllTests.test_chunksize-527"><span class="linenos">527</span></a>        <span class="n">rz</span> <span class="o">=</span> <span class="n">RatZarr</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">)</span>
</span><span id="AllTests.test_chunksize-528"><a href="#AllTests.test_chunksize-528"><span class="linenos">528</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span>
</span><span id="AllTests.test_chunksize-529"><a href="#AllTests.test_chunksize-529"><span class="linenos">529</span></a>        <span class="n">ratChunk</span> <span class="o">=</span> <span class="n">rz</span><span class="o">.</span><span class="n">getRATChunkSize</span><span class="p">()</span>
</span><span id="AllTests.test_chunksize-530"><a href="#AllTests.test_chunksize-530"><span class="linenos">530</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ratChunk</span><span class="p">,</span> <span class="n">DFLT_CHUNKSIZE</span><span class="p">,</span>
</span><span id="AllTests.test_chunksize-531"><a href="#AllTests.test_chunksize-531"><span class="linenos">531</span></a>                         <span class="sa">f</span><span class="s1">&#39;Unexpected chunk size </span><span class="si">{</span><span class="n">ratChunk</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="AllTests.test_chunksize-532"><a href="#AllTests.test_chunksize-532"><span class="linenos">532</span></a>        <span class="n">newChunk</span> <span class="o">=</span> <span class="mi">100000</span>
</span><span id="AllTests.test_chunksize-533"><a href="#AllTests.test_chunksize-533"><span class="linenos">533</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">setChunkSize</span><span class="p">(</span><span class="n">newChunk</span><span class="p">)</span>
</span><span id="AllTests.test_chunksize-534"><a href="#AllTests.test_chunksize-534"><span class="linenos">534</span></a>        <span class="n">ratChunk</span> <span class="o">=</span> <span class="n">rz</span><span class="o">.</span><span class="n">getRATChunkSize</span><span class="p">()</span>
</span><span id="AllTests.test_chunksize-535"><a href="#AllTests.test_chunksize-535"><span class="linenos">535</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ratChunk</span><span class="p">,</span> <span class="n">newChunk</span><span class="p">,</span>
</span><span id="AllTests.test_chunksize-536"><a href="#AllTests.test_chunksize-536"><span class="linenos">536</span></a>                         <span class="sa">f</span><span class="s1">&#39;Chunk size not changed: </span><span class="si">{</span><span class="n">ratChunk</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="AllTests.test_chunksize-537"><a href="#AllTests.test_chunksize-537"><span class="linenos">537</span></a>
</span><span id="AllTests.test_chunksize-538"><a href="#AllTests.test_chunksize-538"><span class="linenos">538</span></a>        <span class="n">colName</span> <span class="o">=</span> <span class="s1">&#39;col1&#39;</span>
</span><span id="AllTests.test_chunksize-539"><a href="#AllTests.test_chunksize-539"><span class="linenos">539</span></a>        <span class="n">rz</span><span class="o">.</span><span class="n">createColumn</span><span class="p">(</span><span class="n">colName</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span><span id="AllTests.test_chunksize-540"><a href="#AllTests.test_chunksize-540"><span class="linenos">540</span></a>        <span class="n">colChunk</span> <span class="o">=</span> <span class="n">rz</span><span class="o">.</span><span class="n">getColumnChunkSize</span><span class="p">(</span><span class="n">colName</span><span class="p">)</span>
</span><span id="AllTests.test_chunksize-541"><a href="#AllTests.test_chunksize-541"><span class="linenos">541</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">colChunk</span><span class="p">,</span> <span class="n">newChunk</span><span class="p">,</span>
</span><span id="AllTests.test_chunksize-542"><a href="#AllTests.test_chunksize-542"><span class="linenos">542</span></a>                         <span class="sa">f</span><span class="s1">&#39;Unexpected column chunk </span><span class="si">{</span><span class="n">colChunk</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="AllTests.test_chunksize-543"><a href="#AllTests.test_chunksize-543"><span class="linenos">543</span></a>
</span><span id="AllTests.test_chunksize-544"><a href="#AllTests.test_chunksize-544"><span class="linenos">544</span></a>        <span class="n">rz2</span> <span class="o">=</span> <span class="n">RatZarr</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">)</span>
</span><span id="AllTests.test_chunksize-545"><a href="#AllTests.test_chunksize-545"><span class="linenos">545</span></a>        <span class="n">ratChunk</span> <span class="o">=</span> <span class="n">rz2</span><span class="o">.</span><span class="n">getRATChunkSize</span><span class="p">()</span>
</span><span id="AllTests.test_chunksize-546"><a href="#AllTests.test_chunksize-546"><span class="linenos">546</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ratChunk</span><span class="p">,</span> <span class="n">newChunk</span><span class="p">,</span>
</span><span id="AllTests.test_chunksize-547"><a href="#AllTests.test_chunksize-547"><span class="linenos">547</span></a>                         <span class="s1">&#39;Chunk size not preserved on disk&#39;</span><span class="p">)</span>
</span><span id="AllTests.test_chunksize-548"><a href="#AllTests.test_chunksize-548"><span class="linenos">548</span></a>
</span><span id="AllTests.test_chunksize-549"><a href="#AllTests.test_chunksize-549"><span class="linenos">549</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deleteTestFile</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Chunk size manipulation</p>
</div>


                            </div>
                            <div id="AllTests.makeFilename" class="classattr">
                                        <input id="AllTests.makeFilename-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">makeFilename</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">filename</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="AllTests.makeFilename-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AllTests.makeFilename"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AllTests.makeFilename-551"><a href="#AllTests.makeFilename-551"><span class="linenos">551</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">makeFilename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="AllTests.makeFilename-552"><a href="#AllTests.makeFilename-552"><span class="linenos">552</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AllTests.makeFilename-553"><a href="#AllTests.makeFilename-553"><span class="linenos">553</span></a><span class="sd">        Make full filename string</span>
</span><span id="AllTests.makeFilename-554"><a href="#AllTests.makeFilename-554"><span class="linenos">554</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AllTests.makeFilename-555"><a href="#AllTests.makeFilename-555"><span class="linenos">555</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">s3bucket</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;S3BUCKET&#39;</span><span class="p">)</span>
</span><span id="AllTests.makeFilename-556"><a href="#AllTests.makeFilename-556"><span class="linenos">556</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">s3bucket</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">boto3</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AllTests.makeFilename-557"><a href="#AllTests.makeFilename-557"><span class="linenos">557</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;S3BUCKET given, boto3 unavailable&quot;</span><span class="p">)</span>
</span><span id="AllTests.makeFilename-558"><a href="#AllTests.makeFilename-558"><span class="linenos">558</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">usingS3</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s3bucket</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">boto3</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="AllTests.makeFilename-559"><a href="#AllTests.makeFilename-559"><span class="linenos">559</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">usingS3</span><span class="p">:</span>
</span><span id="AllTests.makeFilename-560"><a href="#AllTests.makeFilename-560"><span class="linenos">560</span></a>            <span class="n">fullFilename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;s3://</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">s3bucket</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AllTests.makeFilename-561"><a href="#AllTests.makeFilename-561"><span class="linenos">561</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AllTests.makeFilename-562"><a href="#AllTests.makeFilename-562"><span class="linenos">562</span></a>            <span class="n">fullFilename</span> <span class="o">=</span> <span class="n">filename</span>
</span><span id="AllTests.makeFilename-563"><a href="#AllTests.makeFilename-563"><span class="linenos">563</span></a>        <span class="k">return</span> <span class="n">fullFilename</span>
</span></pre></div>


            <div class="docstring"><p>Make full filename string</p>
</div>


                            </div>
                            <div id="AllTests.deleteTestFile" class="classattr">
                                        <input id="AllTests.deleteTestFile-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">deleteTestFile</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">filename</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="AllTests.deleteTestFile-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AllTests.deleteTestFile"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AllTests.deleteTestFile-565"><a href="#AllTests.deleteTestFile-565"><span class="linenos">565</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">deleteTestFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="AllTests.deleteTestFile-566"><a href="#AllTests.deleteTestFile-566"><span class="linenos">566</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AllTests.deleteTestFile-567"><a href="#AllTests.deleteTestFile-567"><span class="linenos">567</span></a><span class="sd">        Delete the given test file, if it exists</span>
</span><span id="AllTests.deleteTestFile-568"><a href="#AllTests.deleteTestFile-568"><span class="linenos">568</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AllTests.deleteTestFile-569"><a href="#AllTests.deleteTestFile-569"><span class="linenos">569</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">usingS3</span><span class="p">:</span>
</span><span id="AllTests.deleteTestFile-570"><a href="#AllTests.deleteTestFile-570"><span class="linenos">570</span></a>            <span class="n">s3client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span>
</span><span id="AllTests.deleteTestFile-571"><a href="#AllTests.deleteTestFile-571"><span class="linenos">571</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">s3client</span><span class="o">.</span><span class="n">list_objects</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">s3bucket</span><span class="p">,</span>
</span><span id="AllTests.deleteTestFile-572"><a href="#AllTests.deleteTestFile-572"><span class="linenos">572</span></a>                                             <span class="n">Prefix</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
</span><span id="AllTests.deleteTestFile-573"><a href="#AllTests.deleteTestFile-573"><span class="linenos">573</span></a>            <span class="k">if</span> <span class="s1">&#39;Contents&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
</span><span id="AllTests.deleteTestFile-574"><a href="#AllTests.deleteTestFile-574"><span class="linenos">574</span></a>                <span class="n">objectKeyList</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;Key&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;Contents&#39;</span><span class="p">]]</span>
</span><span id="AllTests.deleteTestFile-575"><a href="#AllTests.deleteTestFile-575"><span class="linenos">575</span></a>                <span class="n">objSpec</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Objects&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;Key&#39;</span><span class="p">:</span> <span class="n">k</span><span class="p">}</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">objectKeyList</span><span class="p">]}</span>
</span><span id="AllTests.deleteTestFile-576"><a href="#AllTests.deleteTestFile-576"><span class="linenos">576</span></a>                <span class="n">s3client</span><span class="o">.</span><span class="n">delete_objects</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">s3bucket</span><span class="p">,</span>
</span><span id="AllTests.deleteTestFile-577"><a href="#AllTests.deleteTestFile-577"><span class="linenos">577</span></a>                                        <span class="n">Delete</span><span class="o">=</span><span class="n">objSpec</span><span class="p">)</span>
</span><span id="AllTests.deleteTestFile-578"><a href="#AllTests.deleteTestFile-578"><span class="linenos">578</span></a>
</span><span id="AllTests.deleteTestFile-579"><a href="#AllTests.deleteTestFile-579"><span class="linenos">579</span></a>            <span class="c1"># Wait until it is actually gone</span>
</span><span id="AllTests.deleteTestFile-580"><a href="#AllTests.deleteTestFile-580"><span class="linenos">580</span></a>            <span class="k">while</span> <span class="s1">&#39;Contents&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
</span><span id="AllTests.deleteTestFile-581"><a href="#AllTests.deleteTestFile-581"><span class="linenos">581</span></a>                <span class="n">response</span> <span class="o">=</span> <span class="n">s3client</span><span class="o">.</span><span class="n">list_objects</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">s3bucket</span><span class="p">,</span>
</span><span id="AllTests.deleteTestFile-582"><a href="#AllTests.deleteTestFile-582"><span class="linenos">582</span></a>                                                 <span class="n">Prefix</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
</span><span id="AllTests.deleteTestFile-583"><a href="#AllTests.deleteTestFile-583"><span class="linenos">583</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AllTests.deleteTestFile-584"><a href="#AllTests.deleteTestFile-584"><span class="linenos">584</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
</span><span id="AllTests.deleteTestFile-585"><a href="#AllTests.deleteTestFile-585"><span class="linenos">585</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Delete the given test file, if it exists</p>
</div>


                            </div>
                </section>
                <section id="mainCmd">
                            <input id="mainCmd-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mainCmd</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="mainCmd-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#mainCmd"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="mainCmd-588"><a href="#mainCmd-588"><span class="linenos">588</span></a><span class="k">def</span><span class="w"> </span><span class="nf">mainCmd</span><span class="p">():</span>
</span><span id="mainCmd-589"><a href="#mainCmd-589"><span class="linenos">589</span></a>    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s1">&#39;ratzarr&#39;</span><span class="p">)</span>
</span></pre></div>


    

                </section>
    </main>
</body>
</html>